{"version":3,"sources":["images.es6"],"names":["_mithril","require","_github","_mithrilInfinite","_styler","_imagesStyle","_styler2","add","_imagesStyle2","IMG_URL","vm","expanded","dirty","toggle","id","isExpanded","isDirty","clearDirty","item","data","opts","page","src","heightFraction","_mithril2","style","height","parseFloat","onclick","width","config","el","inited","context","_mithrilInfinite2","isElementInViewport","url","backgroundImage","trust","component","view","maxPages","pageUrl","preloadPages","class","before","join","after","_github2","pageChange","console","log"],"mappings":"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","file":"images.js","sourcesContent":["'use strict';\n\nimport m from 'mithril';\nimport github from 'app/app/github';\nimport infinite from 'mithril-infinite';\nimport styler from 'app/app/styler';\n\nimport imagesStyle from './images-style';\nstyler.add('images', imagesStyle);\n\nconst IMG_URL = 'http://arthurclemens.github.io/assets/mithril-infinite-scroll/thumbs/';\n\nlet vm = {\n    expanded: {},\n    dirty: {},\n    toggle: id => {\n        if (vm.expanded[id]) {\n            delete vm.expanded[id];\n        } else {\n            vm.expanded[id] = 1;\n        }\n        vm.dirty[id] = 1;\n    },\n    isExpanded: id => vm.expanded[id],\n    isDirty: id => vm.dirty[id],\n    clearDirty: id => delete vm.dirty[id]\n};\n\nlet item = (data, opts) => {\n    const id = opts.page + data.src;\n    const isExpanded = vm.isExpanded(id);\n    const isDirty = vm.isDirty(id);\n    const heightFraction = isExpanded ? 0.5 : 0.25;\n\n    return m('a.list-item', {\n        style: {\n            height: (parseFloat(data.height) * heightFraction) + 'px'\n        },\n        onclick: () => {\n            vm.toggle(id);\n        }\n    }, [\n        m('span.pageNum', opts.page),\n        m('.image', {\n            style: {\n                height: (parseFloat(data.height) * heightFraction) + 'px',\n                width: (parseFloat(data.width) * heightFraction) + 'px'\n            },\n            config: (el, inited, context) => {\n                if (context.inited && !isDirty) {\n                    return;\n                }\n                if (infinite.isElementInViewport({el: el})) {\n                    const url = IMG_URL + data.src;\n                    el.style.backgroundImage = el.style.backgroundImage = 'url(' + url + ')';\n                    context.inited = true;\n                    vm.clearDirty(id);\n                }\n            }\n        }),\n        // minus or plus sign\n        m('.toggle', isExpanded ? m.trust('&#150;') : m.trust('&#43;'))\n    ]);\n};\n\nlet component = {};\ncomponent.view = () => {\n    return m.component(infinite, {\n        maxPages: 20,\n        item: item,\n        pageUrl: page => 'app/images/data/page-' + page + '.json',\n        preloadPages: 3,\n        class: 'images',\n        before: m('a', {\n            class: ['list-item', vm.isExpanded('before') ? 'open' : 'closed'].join(' '),\n            onclick: () => {\n                vm.toggle('before');\n            }}, [\n                m('div', m.trust('A list of pugs. Courtesy the <a href=\"http://airbnb.io/infinity/demo-off.html\">AirBnb Infinity demo</a>.')),\n                m('.toggle', vm.isExpanded('before') ? m.trust('&#150;') : m.trust('&#43;'))\n            ]\n        ),\n        after: github(),\n        pageChange: page => {\n            if (console) {\n                console.log('page', page);\n            }\n        }\n    });\n};\n\nexport default component;\n"]}