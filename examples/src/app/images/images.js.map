{"version":3,"sources":["images.es6"],"names":["_mithril","require","_github","_mithrilInfinite","_styler","_imagesStyle","_styler2","add","_imagesStyle2","IMG_URL","vm","expanded","dirty","toggle","id","isExpanded","isDirty","clearDirty","item","data","opts","page","src","heightFraction","_mithril2","style","height","Math","floor","parseInt","onclick","width","config","el","inited","context","_mithrilInfinite2","isElementInViewport","url","backgroundImage","trust","component","view","maxPages","pageUrl","preloadPages","class","before","join","after","_github2","pageChange","console","log"],"mappings":"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","file":"images.js","sourcesContent":["'use strict';\n\nimport m from 'mithril';\nimport github from 'app/app/github';\nimport infinite from 'mithril-infinite';\nimport styler from 'app/app/styler';\n\nimport imagesStyle from './images-style';\nstyler.add('images', imagesStyle);\n\nconst IMG_URL = 'http://arthurclemens.github.io/assets/mithril-infinite-scroll/thumbs/';\n\nlet vm = {\n    expanded: {},\n    dirty: {},\n    toggle: id => {\n        if (vm.expanded[id]) {\n            delete vm.expanded[id];\n        } else {\n            vm.expanded[id] = 1;\n        }\n        vm.dirty[id] = 1;\n    },\n    isExpanded: id => vm.expanded[id],\n    isDirty: id => vm.dirty[id],\n    clearDirty: id => delete vm.dirty[id]\n};\n\nlet item = (data, opts) => {\n    const id = opts.page + data.src;\n    const isExpanded = vm.isExpanded(id);\n    const isDirty = vm.isDirty(id);\n    const heightFraction = isExpanded ? 0.5 : 0.25;\n\n    return m('a.list-item', {\n        style: {\n            height: Math.floor(parseInt(data.height, 10) * heightFraction) + 'px'\n        },\n        onclick: () => {\n            vm.toggle(id);\n        }\n    }, [\n        m('span.pageNum', opts.page),\n        m('.image', {\n            style: {\n                height: Math.floor(parseInt(data.height, 10) * heightFraction) + 'px',\n                width: Math.floor(parseInt(data.width, 10) * heightFraction) + 'px'\n            },\n            config: (el, inited, context) => {\n                if (context.inited && !isDirty) {\n                    return;\n                }\n                if (infinite.isElementInViewport({el: el})) {\n                    const url = IMG_URL + data.src;\n                    el.style.backgroundImage = el.style.backgroundImage = 'url(' + url + ')';\n                    context.inited = true;\n                    vm.clearDirty(id);\n                }\n            }\n        }),\n        // minus or plus sign\n        m('.toggle', isExpanded ? m.trust('&#150;') : m.trust('&#43;'))\n    ]);\n};\n\nlet component = {};\ncomponent.view = () => {\n    return m.component(infinite, {\n        maxPages: 20,\n        item: item,\n        pageUrl: page => 'app/images/data/page-' + page + '.json',\n        preloadPages: 3,\n        class: 'images',\n        before: m('a', {\n            class: ['list-item', vm.isExpanded('before') ? 'open' : 'closed'].join(' '),\n            onclick: () => {\n                vm.toggle('before');\n            }}, [\n                m('div', m.trust('A list of pugs. Courtesy the <a href=\"http://airbnb.io/infinity/demo-off.html\">AirBnb Infinity demo</a>.')),\n                m('.toggle', vm.isExpanded('before') ? m.trust('&#150;') : m.trust('&#43;'))\n            ]\n        ),\n        after: github(),\n        pageChange: page => {\n            if (console) {\n                console.log('page', page);\n            }\n        }\n    });\n};\n\nexport default component;\n"]}