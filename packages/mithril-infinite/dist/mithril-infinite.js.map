{"version":3,"file":"mithril-infinite.js","sources":["../src/classes.js","../src/util.js","../node_modules/mithril/stream/stream.js","../src/page.js","../src/placeholder.js","../src/styler.js","../src/css.js","../src/index.js"],"sourcesContent":["\nexport const classes = {\n  scrollView:    \"mithril-infinite__scroll-view\",\n  scrollViewX:   \"mithril-infinite__scroll-view--x\",\n  scrollViewY:   \"mithril-infinite__scroll-view--y\",\n  scrollContent: \"mithril-infinite__scroll-content\",\n  content:       \"mithril-infinite__content\",\n  pages:         \"mithril-infinite__pages\",\n  page:          \"mithril-infinite__page\",\n  pageEven:      \"mithril-infinite__page--even\",\n  pageOdd:       \"mithril-infinite__page--odd\",\n  placeholder:   \"mithril-infinite__page--placeholder\",\n  before:        \"mithril-infinite__before\",\n  after:         \"mithril-infinite__after\"\n};\n","import verge from \"verge\";\nimport { classes } from \"./classes\";\n\nconst LEEWAY = 300;\n\nexport const getElementSize = (el, axis) => {\n  const styles = window.getComputedStyle(el);\n  if (axis === \"x\") {\n    const margin = parseFloat(styles.marginLeft) + parseFloat(styles.marginRight);\n    return el.scrollWidth + margin;\n  } else {\n    const margin = parseFloat(styles.marginTop) + parseFloat(styles.marginBottom);\n    return el.scrollHeight + margin;\n  }\n};\n\n// el, axis = \"y\", expand = LEEWAY\nexport const isElementInViewport = ({el, axis = \"y\", leeway = LEEWAY}) => {\n  return axis === \"y\"\n    ? verge.inY(el, leeway) || verge.inY(el, -leeway)\n    : axis === \"x\"\n      ? verge.inX(el, leeway) || verge.inX(el, -leeway)\n      : verge.inViewport(el, leeway) || verge.inViewport(el, -leeway);\n};\n\nexport const makeClassName = pageNum => [\n  classes.page,\n  pageNum % 2 === 0 ? classes.pageEven : classes.pageOdd\n].join(\" \");","/* eslint-disable */\n;(function() {\n\"use strict\"\n/* eslint-enable */\n\nvar guid = 0, HALT = {}\nfunction createStream() {\n\tfunction stream() {\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\t\treturn stream._state.value\n\t}\n\tinitStream(stream)\n\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\n\treturn stream\n}\nfunction initStream(stream) {\n\tstream.constructor = createStream\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\n\n\tObject.defineProperties(stream, {\n\t\tend: {get: function() {\n\t\t\tif (!stream._state.endStream) {\n\t\t\t\tvar endStream = createStream()\n\t\t\t\tendStream.map(function(value) {\n\t\t\t\t\tif (value === true) {\n\t\t\t\t\t\tunregisterStream(stream)\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\n\t\t\t\t\t}\n\t\t\t\t\treturn value\n\t\t\t\t})\n\t\t\t\tstream._state.endStream = endStream\n\t\t\t}\n\t\t\treturn stream._state.endStream\n\t\t}}\n\t})\n}\nfunction updateStream(stream, value) {\n\tupdateState(stream, value)\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\n\tif (stream._state.unregister != null) stream._state.unregister()\n\tfinalize(stream)\n}\nfunction updateState(stream, value) {\n\tstream._state.value = value\n\tstream._state.changed = true\n\tif (stream._state.state !== 2) stream._state.state = 1\n}\nfunction updateDependency(stream, mustSync) {\n\tvar state = stream._state, parents = state.parents\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\n\t\tvar value = stream._state.derive()\n\t\tif (value === HALT) return false\n\t\tupdateState(stream, value)\n\t}\n}\nfunction finalize(stream) {\n\tstream._state.changed = false\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\n}\n\nfunction combine(fn, streams) {\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\n\treturn initDependency(createStream(), streams, function() {\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\n\t})\n}\n\nfunction initDependency(dep, streams, derive) {\n\tvar state = dep._state\n\tstate.derive = derive\n\tstate.parents = streams.filter(notEnded)\n\n\tregisterDependency(dep, state.parents)\n\tupdateDependency(dep, true)\n\n\treturn dep\n}\nfunction registerDependency(stream, parents) {\n\tfor (var i = 0; i < parents.length; i++) {\n\t\tparents[i]._state.deps[stream._state.id] = stream\n\t\tregisterDependency(stream, parents[i]._state.parents)\n\t}\n}\nfunction unregisterStream(stream) {\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\n\t\tvar parent = stream._state.parents[i]\n\t\tdelete parent._state.deps[stream._state.id]\n\t}\n\tfor (var id in stream._state.deps) {\n\t\tvar dependent = stream._state.deps[id]\n\t\tvar index = dependent._state.parents.indexOf(stream)\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\n\t}\n\tstream._state.state = 2 //ended\n\tstream._state.deps = {}\n}\n\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\nfunction valueOf() {return this._state.value}\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\n\nfunction valid(stream) {return stream._state }\nfunction active(stream) {return stream._state.state === 1}\nfunction changed(stream) {return stream._state.changed}\nfunction notEnded(stream) {return stream._state.state !== 2}\n\nfunction merge(streams) {\n\treturn combine(function() {\n\t\treturn streams.map(function(s) {return s()})\n\t}, streams)\n}\n\nfunction scan(reducer, seed, stream) {\n\tvar newStream = combine(function (s) {\n\t\treturn seed = reducer(seed, s._state.value)\n\t}, [stream])\n\n\tif (newStream._state.state === 0) newStream(seed)\n\n\treturn newStream\n}\n\nfunction scanMerge(tuples, seed) {\n\tvar streams = tuples.map(function(tuple) {\n\t\tvar stream = tuple[0]\n\t\tif (stream._state.state === 0) stream(undefined)\n\t\treturn stream\n\t})\n\n\tvar newStream = combine(function() {\n\t\tvar changed = arguments[arguments.length - 1]\n\n\t\tstreams.forEach(function(stream, idx) {\n\t\t\tif (changed.indexOf(stream) > -1) {\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\n\t\t\t}\n\t\t})\n\n\t\treturn seed\n\t}, streams)\n\n\treturn newStream\n}\n\ncreateStream[\"fantasy-land/of\"] = createStream\ncreateStream.merge = merge\ncreateStream.combine = combine\ncreateStream.scan = scan\ncreateStream.scanMerge = scanMerge\ncreateStream.HALT = HALT\n\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\nelse window.m = {stream : createStream}\n\n}());\n","import m from \"mithril\";\nimport stream from \"mithril/stream\";\nimport ResizeObserver from \"resize-observer-polyfill\";\nimport { getElementSize, makeClassName } from \"./util\";\n\nconst getPageData = url =>\n  m.request({\n    method: \"GET\",\n    url\n  });\n\nconst oninit = ({ state, attrs }) => {\n  const pageNum = attrs.pageNum;\n  let content = stream([]);\n\n  if (attrs.pageData) {\n    const result = attrs.pageData(pageNum);\n    Promise.resolve(result).then(content).then(m.redraw);\n  } else if (attrs.pageUrl) {\n    const url = attrs.pageUrl(pageNum);\n    getPageData(url).then(content);\n  }\n\n  const processPageData = attrs.processPageData || ((content, attrs1) =>\n    content && content.length\n      ? content.map((data, index) => attrs.item(data, attrs1, index))\n      : null\n  );\n\n  state.content = content;\n  // Memoize some properties that do not change\n  state.className = makeClassName(pageNum);\n  state.pageTag = attrs.pageTag || \"div\";\n  state.processPageData = processPageData;\n};\n\nconst view = ({state, attrs}) => {\n  const pageId = attrs.pageId;\n  const storedPageSize = attrs.pageSizes[pageId] || 0;\n  let pageSize = 0;\n\n  // attrs/pageSize overrides all measurements on elements here\n  if (attrs.pageSize) {\n    pageSize = attrs.pageSize(state.content());\n    attrs.updatePageSize(pageId, pageSize);\n  }\n\n  const cssSize = pageSize\n    ? pageSize + \"px\"\n    : !attrs.autoSize\n      ? storedPageSize + \"px\"\n      : \"auto\";\n\n  const update = dom => {\n    if (pageSize) return;\n    const size = getElementSize(dom, attrs.axis);\n    if (size) {\n      attrs.updatePageSize(pageId, size);\n    }\n  };\n\n  return m(state.pageTag, {\n    \"data-page\": pageId,\n    class: state.className,\n    style: storedPageSize\n      ? attrs.axis === \"x\"\n        ? { width: cssSize }\n        : { height: cssSize }\n      : null,\n    oncreate: ({ dom }) => {\n      const ro = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const { width, height } = entry.contentRect;\n          if (\n            (attrs.axis === \"x\" && width !== storedPageSize)\n            || (attrs.axis === \"y\" && height !== storedPageSize)\n          ) {\n            update(dom);\n          }\n        }\n      });\n      ro.observe(dom);\n      // update(dom);\n    },\n    onupdate: ({ dom }) => update(dom)\n  }, state.processPageData(state.content(), {\n    pageId: attrs.pageId,\n    pageNum: attrs.pageNum\n  }));\n};\n\nexport const page = {\n  oninit,\n  view\n};\n","import m from \"mithril\";\nimport { makeClassName } from \"./util\";\nimport { classes } from \"./classes\";\n\nexport const placeholder = {\n  oninit: vnode =>\n    // Memoize some properties that do not change\n    vnode.state.className = makeClassName(vnode.attrs.pageNum),\n  view: ({ state, attrs }) => {\n    const pageId = attrs.pageId;\n    const storedPageSize = attrs.pageSizes[pageId] || 0;\n\n    return m(\"div\", {\n      \"data-page\": pageId,\n      class: [\n        classes.placeholder,\n        state.className\n      ].join(\" \"),\n      style: Object.assign(\n        {},\n        attrs.axis === \"x\"\n          ? { width:  storedPageSize + \"px\" }\n          : { height: storedPageSize + \"px\" }\n      )\n    });\n  }\n};\n","import J2c from \"j2c\";\nconst j2c = new J2c();\n\n/*\n * @param id: identifier, used as HTMLElement id for the attached <style></style> element\n * @param styles: list of lists style Objects\n */\nexport const addStyle = (id, ...styles) => {\n  removeStyle(id);\n  const styleEl = document.createElement(\"style\");\n  if (id) {\n    styleEl.setAttribute(\"id\", id);\n  }\n  styles.forEach((styleList) => {\n    // each style returns a list\n    if (Object.keys(styleList).length) {\n      styleList.forEach((style) => {\n        const scoped = { \"@global\": style };\n        const sheet = j2c.sheet(scoped);\n        styleEl.appendChild(document.createTextNode(sheet));\n      });\n    }\n  });\n  document.head.appendChild(styleEl);\n};\n\nconst removeStyle = id => {\n  if (id) {\n    const old = document.getElementById(id);\n    if (old) {\n      old.parentNode.removeChild(old);\n    }\n  }\n};","import { addStyle } from \"./styler\";\nimport { classes } from \"./classes\";\n\nconst styles = [{\n  [\".\" + classes.scrollView]: {\n    \"-webkit-overflow-scrolling\": \"touch\",\n    height: \"100%\",\n\n    [\"&.\" + classes.scrollViewY]: {\n      overflowX: \"hidden\",\n      overflowY: \"auto\",\n      height: \"100%\",\n\n      [\" .\" + classes.scrollContent]: {\n        height: \"100%\",\n        overflowAnchor: \"none\",\n      }\n    },\n\n    [\"&.\" + classes.scrollViewX]: {\n      overflowX: \"auto\",\n      overflowY: \"hidden\",\n      width: \"100%\",\n\n      [\" .\" + classes.scrollContent]: {\n        width: \"100%\"\n      }\n    }\n  }\n  // by default unstyled:\n  // mithril-infinite__content\n  // mithril-infinite__pages\n  // mithril-infinite__page\n}];\n\naddStyle(\"mithril-infinite\", styles);\n","import m from \"mithril\";\nimport { classes } from \"./classes\";\nimport { getElementSize, isElementInViewport } from \"./util\";\nimport { page } from \"./page\";\nimport { placeholder } from \"./placeholder\";\nimport \"./css\";\n\nconst SEL_PADDING = \"000000\";\n\nconst numToId = pageNum =>\n  SEL_PADDING.substring(0, SEL_PADDING.length - (\"\" + pageNum).length) + pageNum;\n\nconst calculateCurrentPageNum = (scrollAmount, state) => {\n  const pageNumKeys = state.sortedKeys;\n  if (pageNumKeys.length === 0) {\n    return 1;\n  }\n  let acc = state.beforeSize || 0;\n  let currentPageNum = 1;\n  for (let i = 0; i < pageNumKeys.length; i = i + 1) {\n    let pageKey = pageNumKeys[i];\n    if (scrollAmount > acc) {\n      currentPageNum = parseInt(pageKey, 10);\n    }\n    acc += state.pageSizes[pageKey];\n  }\n  return currentPageNum;\n};\n\nconst calculateContentSize = (from, to, state) => {\n  const fromIndex = Math.max(0, from - 1);\n  if (to < fromIndex) {\n    return 0;\n  }\n  const toIndex = to;\n  const pageNumKeys = state.sortedKeys.slice(fromIndex, toIndex);\n  let size = state.beforeSize || 0;\n  size = pageNumKeys.reduce((total, pageKey) => (\n    total += state.pageSizes[pageKey] || 0\n  ), size);\n  size += state.afterSize || 0;\n  return size;\n};\n\nconst isPageInViewport = (page, axis, state, scrollView) => {\n  if (!scrollView) {\n    return false;\n  }\n  const id = numToId(page);\n  const el = scrollView.querySelector(`[data-page=\"${id}\"]`);\n  return isElementInViewport({ el, axis });\n};\n\nconst updatePageSize = state => (pageId, size) => (\n  state.pageSizes[pageId] = parseInt(size, 10),\n  state.sortedKeys = Object.keys(state.pageSizes).sort(),\n  calculatePreloadSlots(state)\n);\n\nconst updatePart = (dom, whichSize, state, axis) => {\n  const size = getElementSize(dom, axis);\n  if (size) {\n    state[whichSize] = size;\n  }\n};\n\nconst calculatePreloadSlots = state => {\n  if (!state.scrollView) return;\n  const boundingClientRect = state.scrollView.getBoundingClientRect();\n  state.boundingClientRect = state.boundingClientRect || boundingClientRect;\n  if (boundingClientRect.width !== state.boundingClientRect.width\n    || boundingClientRect.height !== state.boundingClientRect.height\n  ) {\n    state.preloadSlots = state.attrsPreloadSlots || 1;\n  }\n  state.boundingClientRect = boundingClientRect;\n\n  // calculate if we have room on the screen to show more slots\n  if (state.contentSize\n    && (state.preloadSlots < state.pageCount)\n    && (state.preloadSlots <= state.attrsMaxPreloadSlots)\n    && (state.contentSize < boundingClientRect.height)\n  ) {\n    state.preloadSlots++;\n    setTimeout(m.redraw, 0);\n  }\n};\n\nconst getPageList = (currentPageNum, fromPage, toPage, currentPage, preloadSlots, maxPages) => {\n  const minPageNum = fromPage\n    ? parseInt(fromPage, 10)\n    : currentPage\n      ? currentPage\n      : 1;\n  const maxPageNum = toPage\n    ? parseInt(toPage, 10)\n    : currentPage\n      ? currentPage\n      : maxPages;\n  const pages = [];\n  const prePages = [];\n  for (let i = -preloadSlots; i <= preloadSlots; i = i + 1) {\n    const pageNum = currentPageNum + i;\n    if (pageNum >= minPageNum && pageNum <= maxPageNum) {\n      pages.push(pageNum);\n    }\n  }\n  for (let pageNum = 1; pageNum < pages[0]; pageNum = pageNum + 1) {\n    prePages.push(pageNum);\n  }\n  return {pages, prePages, maxPageNum};\n};\n\nconst oninit = vnode => {\n  const attrs = vnode.attrs;\n  // Memoize some properties that do not change\n  const axis = attrs.axis || \"y\";\n  const whichScroll = axis === \"x\" ? \"scrollLeft\" : \"scrollTop\";\n  const autoSize = (attrs.autoSize !== undefined && attrs.autoSize === false) ? false : true;\n  const pageSize = attrs.pageSize;\n  const contentTag = attrs.contentTag || \"div\";\n  const classList = [\n    classes.scrollView,\n    axis === \"x\"\n      ? classes.scrollViewX\n      : classes.scrollViewY,\n    attrs.class\n  ].join(\" \");\n\n  const scroll = () => m.redraw();\n\n  vnode.state = {\n    afterSize: null,\n    beforeSize: null,\n    boundingClientRect: {},\n    currentPageNum: 0,\n    pageSizes: {},\n    preloadSlots: attrs.preloadPages || 1,\n    scrollView: null,\n    sortedKeys: [],\n\n    // Memoized\n    attrsMaxPreloadSlots: attrs.maxPreloadPages || Number.MAX_VALUE,\n    attrsPreloadSlots: attrs.preloadPages || 1,\n    autoSize,\n    axis,\n    classList,\n    contentTag,\n    pageSize,\n    scroll,\n    whichScroll,\n  };\n};\n\nconst view = ({ state, attrs }) => {\n  const scrollAmount = state.scrollView ? state.scrollView[state.whichScroll] : 0;\n  const axis = state.axis;\n  const maxPages = attrs.maxPages !== undefined ? attrs.maxPages : Number.MAX_VALUE;\n  \n  const currentPageNum = attrs.currentPage\n    ? parseInt(attrs.currentPage, 10)\n    : calculateCurrentPageNum(scrollAmount, state);\n\n  if (attrs.pageChange && currentPageNum !== state.currentPageNum) {\n    attrs.pageChange(currentPageNum);\n  }\n  state.currentPageNum = currentPageNum;\n\n  if (state.scrollView && attrs.getDimensions) {\n    attrs.getDimensions({\n      scrolled: scrollAmount,\n      size: state.contentSize\n    });\n  }\n\n  const { pages, prePages, maxPageNum } = getPageList(currentPageNum, attrs.from, attrs.to, attrs.currentPage, state.preloadSlots, maxPages);\n  state.contentSize = attrs.contentSize !== undefined\n    ? attrs.contentSize\n    : calculateContentSize(1, maxPageNum, state);\n\n  state.pageCount = pages.length;\n\n  const isLastPageVisible = maxPageNum\n    ? isPageInViewport(maxPageNum, axis, state, state.scrollView)\n    : true;\n\n  return m(\"div\",\n    {\n      oncreate: ({ dom }) => {\n        state.scrollView = attrs.scrollView\n          ? document.querySelector(attrs.scrollView)\n          : dom;\n        state.scrollView.className += \" \" + state.classList;\n\n        if (attrs.setDimensions) {\n          const dimensions = attrs.setDimensions();\n          if (dimensions.size > 0) {\n            const whichSize = axis === \"x\"\n              ? \"width\"\n              : \"height\";\n            dom.style[whichSize] = dimensions.size + \"px\";\n          }\n          state.scrollView[state.whichScroll] = dimensions.scrolled;\n        }\n        state.scrollView.addEventListener(\"scroll\", state.scroll);\n      },\n      onremove: () => state.scrollView.removeEventListener(\"scroll\", state.scroll)\n    },\n    m(\"div\",\n      {\n        class: classes.scrollContent,\n        style: !state.autoSize\n          ? null\n          : Object.assign(\n            {},\n            axis === \"x\"\n              ? { width: state.contentSize + \"px\" }\n              : { height: state.contentSize + \"px\" },\n            attrs.contentSize\n              ? axis === \"x\"\n                ? { \"min-width\": attrs.contentSize + \"px\" }\n                : { \"min-height\": attrs.contentSize + \"px\" }\n              : {}\n          )\n      },\n      [\n        m(state.contentTag, { class: classes.content }, [\n          attrs.before\n            ? m(\"div\", {\n              class: classes.before,\n              oncreate: ({ dom }) => updatePart(dom, \"before\", state, axis),\n              onupdate: ({ dom }) => updatePart(dom, \"before\", state, axis)\n            }, attrs.before)\n            : null,\n          m(\"div\", { class: classes.pages }, [\n            prePages.map(pageNum => \n              m(placeholder, {\n                axis,\n                key: (attrs.pageKey || numToId)(pageNum),\n                pageId: numToId(pageNum),\n                pageNum,\n                pageSizes: state.pageSizes\n              })\n            ),\n            pages.map(pageNum =>\n              m(page, {\n                autoSize: state.autoSize,\n                axis,\n                item: attrs.item,\n                key: (attrs.pageKey || numToId)(pageNum),\n                pageData: attrs.pageData,\n                pageId: numToId(pageNum),\n                pageNum,\n                pageSize: state.pageSize,\n                pageSizes: state.pageSizes,\n                pageTag: attrs.pageTag,\n                pageUrl: attrs.pageUrl,\n                updatePageSize: updatePageSize(state)\n              })\n            )\n          ]),\n          // only show \"after\" when content is available\n          attrs.after && state.contentSize\n            ? m(\"div\", {\n              class: classes.after,\n              style: {\n                // visually hide this element until the last page is into view\n                // to prevent flashes of after content when scrolling fast\n                visibility: isLastPageVisible ? \"visible\" : \"hidden\"\n              },\n              oncreate: ({ dom }) => updatePart(dom, \"after\", state, axis),\n              onupdate: ({ dom }) => updatePart(dom, \"after\", state, axis),\n            }, attrs.after)\n            : null\n        ])\n      ]\n    )\n  );\n};\n\nexport const infinite = {\n  oninit,\n  view,\n  isElementInViewport\n};\n\n"],"names":["classes","getElementSize","el","axis","styles","window","getComputedStyle","margin","parseFloat","marginLeft","marginRight","scrollWidth","marginTop","marginBottom","scrollHeight","isElementInViewport","leeway","verge","inY","inX","inViewport","makeClassName","page","pageNum","pageEven","pageOdd","join","createStream","stream","arguments","length","HALT","updateStream","_state","value","constructor","id","guid","undefined","state","derive","recover","deps","parents","endStream","unregister","map","ap","valueOf","toJSON","toString","defineProperties","get","changed","updateState","updateDependency","mustSync","every","active","some","combine","fn","streams","valid","Error","dep","filter","notEnded","initDependency","apply","this","concat","registerDependency","i","unregisterStream","dependent","index","indexOf","splice","s1","s2","merge","s","scan","reducer","seed","newStream","scanMerge","tuples","tuple","forEach","idx","attrs","content","pageData","result","resolve","then","m","redraw","pageUrl","request","processPageData","attrs1","data","item","className","pageTag","pageId","storedPageSize","pageSizes","pageSize","updatePageSize","cssSize","autoSize","update","size","dom","width","height","ResizeObserver","entries","contentRect","observe","placeholder","vnode","_extends","j2c","J2c","removeStyle","old","document","getElementById","parentNode","removeChild","styleEl","createElement","setAttribute","styleList","Object","keys","style","scoped","@global","sheet","appendChild","createTextNode","head","addStyle","scrollView","scrollViewY","scrollContent","scrollViewX","numToId","substring","updatePart","whichSize","calculatePreloadSlots","boundingClientRect","getBoundingClientRect","preloadSlots","attrsPreloadSlots","contentSize","pageCount","attrsMaxPreloadSlots","whichScroll","contentTag","classList","class","preloadPages","maxPreloadPages","Number","MAX_VALUE","scrollAmount","maxPages","currentPageNum","currentPage","parseInt","pageNumKeys","sortedKeys","acc","beforeSize","pageKey","calculateCurrentPageNum","pageChange","getDimensions","fromPage","toPage","minPageNum","maxPageNum","pages","prePages","push","getPageList","from","to","fromIndex","Math","max","toIndex","slice","reduce","total","afterSize","calculateContentSize","isLastPageVisible","querySelector","isPageInViewport","setDimensions","dimensions","scrolled","addEventListener","scroll","removeEventListener","min-width","min-height","before","sort","after"],"mappings":"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"}