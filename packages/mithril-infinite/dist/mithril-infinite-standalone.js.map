{"version":3,"file":"mithril-infinite-standalone.js","sources":["../src/classes.js","../node_modules/verge/verge.js","../src/util.js","../node_modules/mithril/stream/stream.js","../node_modules/resize-observer-polyfill/dist/ResizeObserver.es.js","../src/page.js","../src/placeholder.js","../node_modules/j2c/dist/j2c.commonjs.js","../src/styler.js","../src/css.js","../src/index.js"],"sourcesContent":["\nexport const classes = {\n  scrollView:    \"mithril-infinite__scroll-view\",\n  scrollViewX:   \"mithril-infinite__scroll-view--x\",\n  scrollViewY:   \"mithril-infinite__scroll-view--y\",\n  scrollContent: \"mithril-infinite__scroll-content\",\n  content:       \"mithril-infinite__content\",\n  pages:         \"mithril-infinite__pages\",\n  page:          \"mithril-infinite__page\",\n  pageEven:      \"mithril-infinite__page--even\",\n  pageOdd:       \"mithril-infinite__page--odd\",\n  placeholder:   \"mithril-infinite__page--placeholder\",\n  before:        \"mithril-infinite__before\",\n  after:         \"mithril-infinite__after\"\n};\n","/*!\r\n * verge 1.10.2+201705300050\r\n * http://npm.im/verge\r\n * MIT Ryan Van Etten\r\n */\r\n\r\n!function(root, name, make) {\n  if (typeof module != 'undefined' && module['exports']) module['exports'] = make();\r\n  else root[name] = make();\r\n}(this, 'verge', function() {\r\n\r\n  var xports = {}\r\n    , win = typeof window != 'undefined' && window\r\n    , doc = typeof document != 'undefined' && document\r\n    , docElem = doc && doc.documentElement\r\n    , matchMedia = win['matchMedia'] || win['msMatchMedia']\r\n    , mq = matchMedia ? function(q) {\r\n        return !!matchMedia.call(win, q).matches;\r\n      } : function() {\r\n        return false;\r\n      }\r\n    , viewportW = xports['viewportW'] = function() {\r\n        var a = docElem['clientWidth'], b = win['innerWidth'];\r\n        return a < b ? b : a;\r\n      }\r\n    , viewportH = xports['viewportH'] = function() {\r\n        var a = docElem['clientHeight'], b = win['innerHeight'];\r\n        return a < b ? b : a;\r\n      };\r\n\n  /**\n   * Test if a media query is active. Like Modernizr.mq\r\n   * @since 1.6.0\r\n   * @return {boolean}\r\n   */\n  xports['mq'] = mq;\r\n\r\n  /**\n   * Normalized matchMedia\r\n   * @since 1.6.0\r\n   * @return {MediaQueryList|Object}\r\n   */\n  xports['matchMedia'] = matchMedia ? function() {\r\n    // matchMedia must be binded to window\r\n    return matchMedia.apply(win, arguments);\r\n  } : function() {\r\n    // Gracefully degrade to plain object\r\n    return {};\r\n  };\r\n\r\n  /**\r\n   * @since 1.8.0\r\n   * @return {{width:number, height:number}}\r\n   */\r\n  function viewport() {\r\n    return {'width':viewportW(), 'height':viewportH()};\r\n  }\r\n  xports['viewport'] = viewport;\r\n\n  /**\n   * Cross-browser window.scrollX\r\n   * @since 1.0.0\r\n   * @return {number}\r\n   */\r\n  xports['scrollX'] = function() {\r\n    return win.pageXOffset || docElem.scrollLeft;\n  };\r\n\r\n  /**\n   * Cross-browser window.scrollY\r\n   * @since 1.0.0\r\n   * @return {number}\r\n   */\r\n  xports['scrollY'] = function() {\r\n    return win.pageYOffset || docElem.scrollTop;\n  };\r\n\r\n  /**\r\n   * @param {{top:number, right:number, bottom:number, left:number}} coords\r\n   * @param {number=} cushion adjustment\r\n   * @return {Object}\r\n   */\r\n  function calibrate(coords, cushion) {\r\n    var o = {};\r\n    cushion = +cushion || 0;\r\n    o['width'] = (o['right'] = coords['right'] + cushion) - (o['left'] = coords['left'] - cushion);\r\n    o['height'] = (o['bottom'] = coords['bottom'] + cushion) - (o['top'] = coords['top'] - cushion);\r\n    return o;\r\n  }\r\n\r\n  /**\r\n   * Cross-browser element.getBoundingClientRect plus optional cushion.\r\n   * Coords are relative to the top-left corner of the viewport.\r\n   * @since 1.0.0\r\n   * @param {Element|Object} el element or stack (uses first item)\r\n   * @param {number=} cushion +/- pixel adjustment amount\r\n   * @return {Object|boolean}\r\n   */\r\n  function rectangle(el, cushion) {\r\n    el = el && !el.nodeType ? el[0] : el;\r\n    if (!el || 1 !== el.nodeType) return false;\r\n    return calibrate(el.getBoundingClientRect(), cushion);\r\n  }\r\n  xports['rectangle'] = rectangle;\r\n\r\n  /**\r\n   * Get the viewport aspect ratio (or the aspect ratio of an object or element)\r\n   * @since 1.7.0\r\n   * @param {(Element|Object)=} o optional object with width/height props or methods\r\n   * @return {number}\r\n   * @link http://w3.org/TR/css3-mediaqueries/#orientation\r\n   */\r\n  function aspect(o) {\r\n    o = null == o ? viewport() : 1 === o.nodeType ? rectangle(o) : o;\r\n    var h = o['height'], w = o['width'];\r\n    h = typeof h == 'function' ? h.call(o) : h;\r\n    w = typeof w == 'function' ? w.call(o) : w;\r\n    return w/h;\r\n  }\r\n  xports['aspect'] = aspect;\r\n\r\n  /**\r\n   * Test if an element is in the same x-axis section as the viewport.\r\n   * @since 1.0.0\r\n   * @param {Element|Object} el\r\n   * @param {number=} cushion\r\n   * @return {boolean}\r\n   */\r\n  xports['inX'] = function(el, cushion) {\r\n    var r = rectangle(el, cushion);\r\n    return !!r && r.right >= 0 && r.left <= viewportW();\r\n  };\r\n\r\n  /**\r\n   * Test if an element is in the same y-axis section as the viewport.\r\n   * @since 1.0.0\r\n   * @param {Element|Object} el\r\n   * @param {number=} cushion\r\n   * @return {boolean}\r\n   */\r\n  xports['inY'] = function(el, cushion) {\r\n    var r = rectangle(el, cushion);\r\n    return !!r && r.bottom >= 0 && r.top <= viewportH();\r\n  };\r\n\r\n  /**\r\n   * Test if an element is in the viewport.\r\n   * @since 1.0.0\r\n   * @param {Element|Object} el\r\n   * @param {number=} cushion\r\n   * @return {boolean}\r\n   */\r\n  xports['inViewport'] = function(el, cushion) {\r\n    // Equiv to `inX(el, cushion) && inY(el, cushion)` but just manually do both\n    // to avoid calling rectangle() twice. It gzips just as small like this.\r\n    var r = rectangle(el, cushion);\r\n    return !!r && r.bottom >= 0 && r.right >= 0 && r.top <= viewportH() && r.left <= viewportW();\r\n  };\r\n\r\n  return xports;\r\n});\n","import verge from \"verge\";\nimport { classes } from \"./classes\";\n\nconst LEEWAY = 300;\n\nexport const getElementSize = (el, axis) => {\n  const styles = window.getComputedStyle(el);\n  if (axis === \"x\") {\n    const margin = parseFloat(styles.marginLeft) + parseFloat(styles.marginRight);\n    return el.scrollWidth + margin;\n  } else {\n    const margin = parseFloat(styles.marginTop) + parseFloat(styles.marginBottom);\n    return el.scrollHeight + margin;\n  }\n};\n\n// el, axis = \"y\", expand = LEEWAY\nexport const isElementInViewport = ({el, axis = \"y\", leeway = LEEWAY}) => {\n  return axis === \"y\"\n    ? verge.inY(el, leeway) || verge.inY(el, -leeway)\n    : axis === \"x\"\n      ? verge.inX(el, leeway) || verge.inX(el, -leeway)\n      : verge.inViewport(el, leeway) || verge.inViewport(el, -leeway);\n};\n\nexport const makeClassName = pageNum => [\n  classes.page,\n  pageNum % 2 === 0 ? classes.pageEven : classes.pageOdd\n].join(\" \");","/* eslint-disable */\n;(function() {\n\"use strict\"\n/* eslint-enable */\n\nvar guid = 0, HALT = {}\nfunction createStream() {\n\tfunction stream() {\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\t\treturn stream._state.value\n\t}\n\tinitStream(stream)\n\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\n\n\treturn stream\n}\nfunction initStream(stream) {\n\tstream.constructor = createStream\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\n\n\tObject.defineProperties(stream, {\n\t\tend: {get: function() {\n\t\t\tif (!stream._state.endStream) {\n\t\t\t\tvar endStream = createStream()\n\t\t\t\tendStream.map(function(value) {\n\t\t\t\t\tif (value === true) {\n\t\t\t\t\t\tunregisterStream(stream)\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\n\t\t\t\t\t}\n\t\t\t\t\treturn value\n\t\t\t\t})\n\t\t\t\tstream._state.endStream = endStream\n\t\t\t}\n\t\t\treturn stream._state.endStream\n\t\t}}\n\t})\n}\nfunction updateStream(stream, value) {\n\tupdateState(stream, value)\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\n\tif (stream._state.unregister != null) stream._state.unregister()\n\tfinalize(stream)\n}\nfunction updateState(stream, value) {\n\tstream._state.value = value\n\tstream._state.changed = true\n\tif (stream._state.state !== 2) stream._state.state = 1\n}\nfunction updateDependency(stream, mustSync) {\n\tvar state = stream._state, parents = state.parents\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\n\t\tvar value = stream._state.derive()\n\t\tif (value === HALT) return false\n\t\tupdateState(stream, value)\n\t}\n}\nfunction finalize(stream) {\n\tstream._state.changed = false\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\n}\n\nfunction combine(fn, streams) {\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\n\treturn initDependency(createStream(), streams, function() {\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\n\t})\n}\n\nfunction initDependency(dep, streams, derive) {\n\tvar state = dep._state\n\tstate.derive = derive\n\tstate.parents = streams.filter(notEnded)\n\n\tregisterDependency(dep, state.parents)\n\tupdateDependency(dep, true)\n\n\treturn dep\n}\nfunction registerDependency(stream, parents) {\n\tfor (var i = 0; i < parents.length; i++) {\n\t\tparents[i]._state.deps[stream._state.id] = stream\n\t\tregisterDependency(stream, parents[i]._state.parents)\n\t}\n}\nfunction unregisterStream(stream) {\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\n\t\tvar parent = stream._state.parents[i]\n\t\tdelete parent._state.deps[stream._state.id]\n\t}\n\tfor (var id in stream._state.deps) {\n\t\tvar dependent = stream._state.deps[id]\n\t\tvar index = dependent._state.parents.indexOf(stream)\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\n\t}\n\tstream._state.state = 2 //ended\n\tstream._state.deps = {}\n}\n\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\nfunction valueOf() {return this._state.value}\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\n\nfunction valid(stream) {return stream._state }\nfunction active(stream) {return stream._state.state === 1}\nfunction changed(stream) {return stream._state.changed}\nfunction notEnded(stream) {return stream._state.state !== 2}\n\nfunction merge(streams) {\n\treturn combine(function() {\n\t\treturn streams.map(function(s) {return s()})\n\t}, streams)\n}\n\nfunction scan(reducer, seed, stream) {\n\tvar newStream = combine(function (s) {\n\t\treturn seed = reducer(seed, s._state.value)\n\t}, [stream])\n\n\tif (newStream._state.state === 0) newStream(seed)\n\n\treturn newStream\n}\n\nfunction scanMerge(tuples, seed) {\n\tvar streams = tuples.map(function(tuple) {\n\t\tvar stream = tuple[0]\n\t\tif (stream._state.state === 0) stream(undefined)\n\t\treturn stream\n\t})\n\n\tvar newStream = combine(function() {\n\t\tvar changed = arguments[arguments.length - 1]\n\n\t\tstreams.forEach(function(stream, idx) {\n\t\t\tif (changed.indexOf(stream) > -1) {\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\n\t\t\t}\n\t\t})\n\n\t\treturn seed\n\t}, streams)\n\n\treturn newStream\n}\n\ncreateStream[\"fantasy-land/of\"] = createStream\ncreateStream.merge = merge\ncreateStream.combine = combine\ncreateStream.scan = scan\ncreateStream.scanMerge = scanMerge\ncreateStream.HALT = HALT\n\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\nelse window.m = {stream : createStream}\n\n}());\n","/**\r\n * A collection of shims that provide minimal functionality of the ES6 collections.\r\n *\r\n * These implementations are not meant to be used outside of the ResizeObserver\r\n * modules as they cover only a limited range of use cases.\r\n */\n/* eslint-disable require-jsdoc, valid-jsdoc */\nvar MapShim = (function () {\n    if (typeof Map !== 'undefined') {\n        return Map;\n    }\n\n    /**\r\n     * Returns index in provided array that matches the specified key.\r\n     *\r\n     * @param {Array<Array>} arr\r\n     * @param {*} key\r\n     * @returns {number}\r\n     */\n    function getIndex(arr, key) {\n        var result = -1;\n\n        arr.some(function (entry, index) {\n            if (entry[0] === key) {\n                result = index;\n\n                return true;\n            }\n\n            return false;\n        });\n\n        return result;\n    }\n\n    return (function () {\n        function anonymous() {\n            this.__entries__ = [];\n        }\n\n        var prototypeAccessors = { size: { configurable: true } };\n\n        /**\r\n         * @returns {boolean}\r\n         */\n        prototypeAccessors.size.get = function () {\n            return this.__entries__.length;\n        };\n\n        /**\r\n         * @param {*} key\r\n         * @returns {*}\r\n         */\n        anonymous.prototype.get = function (key) {\n            var index = getIndex(this.__entries__, key);\n            var entry = this.__entries__[index];\n\n            return entry && entry[1];\n        };\n\n        /**\r\n         * @param {*} key\r\n         * @param {*} value\r\n         * @returns {void}\r\n         */\n        anonymous.prototype.set = function (key, value) {\n            var index = getIndex(this.__entries__, key);\n\n            if (~index) {\n                this.__entries__[index][1] = value;\n            } else {\n                this.__entries__.push([key, value]);\n            }\n        };\n\n        /**\r\n         * @param {*} key\r\n         * @returns {void}\r\n         */\n        anonymous.prototype.delete = function (key) {\n            var entries = this.__entries__;\n            var index = getIndex(entries, key);\n\n            if (~index) {\n                entries.splice(index, 1);\n            }\n        };\n\n        /**\r\n         * @param {*} key\r\n         * @returns {void}\r\n         */\n        anonymous.prototype.has = function (key) {\n            return !!~getIndex(this.__entries__, key);\n        };\n\n        /**\r\n         * @returns {void}\r\n         */\n        anonymous.prototype.clear = function () {\n            this.__entries__.splice(0);\n        };\n\n        /**\r\n         * @param {Function} callback\r\n         * @param {*} [ctx=null]\r\n         * @returns {void}\r\n         */\n        anonymous.prototype.forEach = function (callback, ctx) {\n            var this$1 = this;\n            if ( ctx === void 0 ) ctx = null;\n\n            for (var i = 0, list = this$1.__entries__; i < list.length; i += 1) {\n                var entry = list[i];\n\n                callback.call(ctx, entry[1], entry[0]);\n            }\n        };\n\n        Object.defineProperties( anonymous.prototype, prototypeAccessors );\n\n        return anonymous;\n    }());\n})();\n\n/**\r\n * Detects whether window and document objects are available in current environment.\r\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined' && window.document === document;\n\n// Returns global object of a current environment.\nvar global$1 = (function () {\n    if (typeof global !== 'undefined' && global.Math === Math) {\n        return global;\n    }\n\n    if (typeof self !== 'undefined' && self.Math === Math) {\n        return self;\n    }\n\n    if (typeof window !== 'undefined' && window.Math === Math) {\n        return window;\n    }\n\n    // eslint-disable-next-line no-new-func\n    return Function('return this')();\n})();\n\n/**\r\n * A shim for the requestAnimationFrame which falls back to the setTimeout if\r\n * first one is not supported.\r\n *\r\n * @returns {number} Requests' identifier.\r\n */\nvar requestAnimationFrame$1 = (function () {\n    if (typeof requestAnimationFrame === 'function') {\n        // It's required to use a bounded function because IE sometimes throws\n        // an \"Invalid calling object\" error if rAF is invoked without the global\n        // object on the left hand side.\n        return requestAnimationFrame.bind(global$1);\n    }\n\n    return function (callback) { return setTimeout(function () { return callback(Date.now()); }, 1000 / 60); };\n})();\n\n// Defines minimum timeout before adding a trailing call.\nvar trailingTimeout = 2;\n\n/**\r\n * Creates a wrapper function which ensures that provided callback will be\r\n * invoked only once during the specified delay period.\r\n *\r\n * @param {Function} callback - Function to be invoked after the delay period.\r\n * @param {number} delay - Delay after which to invoke callback.\r\n * @returns {Function}\r\n */\nvar throttle = function (callback, delay) {\n    var leadingCall = false,\n        trailingCall = false,\n        lastCallTime = 0;\n\n    /**\r\n     * Invokes the original callback function and schedules new invocation if\r\n     * the \"proxy\" was called during current request.\r\n     *\r\n     * @returns {void}\r\n     */\n    function resolvePending() {\n        if (leadingCall) {\n            leadingCall = false;\n\n            callback();\n        }\n\n        if (trailingCall) {\n            proxy();\n        }\n    }\n\n    /**\r\n     * Callback invoked after the specified delay. It will further postpone\r\n     * invocation of the original function delegating it to the\r\n     * requestAnimationFrame.\r\n     *\r\n     * @returns {void}\r\n     */\n    function timeoutCallback() {\n        requestAnimationFrame$1(resolvePending);\n    }\n\n    /**\r\n     * Schedules invocation of the original function.\r\n     *\r\n     * @returns {void}\r\n     */\n    function proxy() {\n        var timeStamp = Date.now();\n\n        if (leadingCall) {\n            // Reject immediately following calls.\n            if (timeStamp - lastCallTime < trailingTimeout) {\n                return;\n            }\n\n            // Schedule new call to be in invoked when the pending one is resolved.\n            // This is important for \"transitions\" which never actually start\n            // immediately so there is a chance that we might miss one if change\n            // happens amids the pending invocation.\n            trailingCall = true;\n        } else {\n            leadingCall = true;\n            trailingCall = false;\n\n            setTimeout(timeoutCallback, delay);\n        }\n\n        lastCallTime = timeStamp;\n    }\n\n    return proxy;\n};\n\n// Minimum delay before invoking the update of observers.\nvar REFRESH_DELAY = 20;\n\n// A list of substrings of CSS properties used to find transition events that\n// might affect dimensions of observed elements.\nvar transitionKeys = ['top', 'right', 'bottom', 'left', 'width', 'height', 'size', 'weight'];\n\n// Check if MutationObserver is available.\nvar mutationObserverSupported = typeof MutationObserver !== 'undefined';\n\n/**\r\n * Singleton controller class which handles updates of ResizeObserver instances.\r\n */\nvar ResizeObserverController = function() {\n    this.connected_ = false;\n    this.mutationEventsAdded_ = false;\n    this.mutationsObserver_ = null;\n    this.observers_ = [];\n\n    this.onTransitionEnd_ = this.onTransitionEnd_.bind(this);\n    this.refresh = throttle(this.refresh.bind(this), REFRESH_DELAY);\n};\n\n/**\r\n * Adds observer to observers list.\r\n *\r\n * @param {ResizeObserverSPI} observer - Observer to be added.\r\n * @returns {void}\r\n */\n\n\n/**\r\n * Holds reference to the controller's instance.\r\n *\r\n * @private {ResizeObserverController}\r\n */\n\n\n/**\r\n * Keeps reference to the instance of MutationObserver.\r\n *\r\n * @private {MutationObserver}\r\n */\n\n/**\r\n * Indicates whether DOM listeners have been added.\r\n *\r\n * @private {boolean}\r\n */\nResizeObserverController.prototype.addObserver = function (observer) {\n    if (!~this.observers_.indexOf(observer)) {\n        this.observers_.push(observer);\n    }\n\n    // Add listeners if they haven't been added yet.\n    if (!this.connected_) {\n        this.connect_();\n    }\n};\n\n/**\r\n * Removes observer from observers list.\r\n *\r\n * @param {ResizeObserverSPI} observer - Observer to be removed.\r\n * @returns {void}\r\n */\nResizeObserverController.prototype.removeObserver = function (observer) {\n    var observers = this.observers_;\n    var index = observers.indexOf(observer);\n\n    // Remove observer if it's present in registry.\n    if (~index) {\n        observers.splice(index, 1);\n    }\n\n    // Remove listeners if controller has no connected observers.\n    if (!observers.length && this.connected_) {\n        this.disconnect_();\n    }\n};\n\n/**\r\n * Invokes the update of observers. It will continue running updates insofar\r\n * it detects changes.\r\n *\r\n * @returns {void}\r\n */\nResizeObserverController.prototype.refresh = function () {\n    var changesDetected = this.updateObservers_();\n\n    // Continue running updates if changes have been detected as there might\n    // be future ones caused by CSS transitions.\n    if (changesDetected) {\n        this.refresh();\n    }\n};\n\n/**\r\n * Updates every observer from observers list and notifies them of queued\r\n * entries.\r\n *\r\n * @private\r\n * @returns {boolean} Returns \"true\" if any observer has detected changes in\r\n *  dimensions of it's elements.\r\n */\nResizeObserverController.prototype.updateObservers_ = function () {\n    // Collect observers that have active observations.\n    var activeObservers = this.observers_.filter(function (observer) {\n        return observer.gatherActive(), observer.hasActive();\n    });\n\n    // Deliver notifications in a separate cycle in order to avoid any\n    // collisions between observers, e.g. when multiple instances of\n    // ResizeObserver are tracking the same element and the callback of one\n    // of them changes content dimensions of the observed target. Sometimes\n    // this may result in notifications being blocked for the rest of observers.\n    activeObservers.forEach(function (observer) { return observer.broadcastActive(); });\n\n    return activeObservers.length > 0;\n};\n\n/**\r\n * Initializes DOM listeners.\r\n *\r\n * @private\r\n * @returns {void}\r\n */\nResizeObserverController.prototype.connect_ = function () {\n    // Do nothing if running in a non-browser environment or if listeners\n    // have been already added.\n    if (!isBrowser || this.connected_) {\n        return;\n    }\n\n    // Subscription to the \"Transitionend\" event is used as a workaround for\n    // delayed transitions. This way it's possible to capture at least the\n    // final state of an element.\n    document.addEventListener('transitionend', this.onTransitionEnd_);\n\n    window.addEventListener('resize', this.refresh);\n\n    if (mutationObserverSupported) {\n        this.mutationsObserver_ = new MutationObserver(this.refresh);\n\n        this.mutationsObserver_.observe(document, {\n            attributes: true,\n            childList: true,\n            characterData: true,\n            subtree: true\n        });\n    } else {\n        document.addEventListener('DOMSubtreeModified', this.refresh);\n\n        this.mutationEventsAdded_ = true;\n    }\n\n    this.connected_ = true;\n};\n\n/**\r\n * Removes DOM listeners.\r\n *\r\n * @private\r\n * @returns {void}\r\n */\nResizeObserverController.prototype.disconnect_ = function () {\n    // Do nothing if running in a non-browser environment or if listeners\n    // have been already removed.\n    if (!isBrowser || !this.connected_) {\n        return;\n    }\n\n    document.removeEventListener('transitionend', this.onTransitionEnd_);\n    window.removeEventListener('resize', this.refresh);\n\n    if (this.mutationsObserver_) {\n        this.mutationsObserver_.disconnect();\n    }\n\n    if (this.mutationEventsAdded_) {\n        document.removeEventListener('DOMSubtreeModified', this.refresh);\n    }\n\n    this.mutationsObserver_ = null;\n    this.mutationEventsAdded_ = false;\n    this.connected_ = false;\n};\n\n/**\r\n * \"Transitionend\" event handler.\r\n *\r\n * @private\r\n * @param {TransitionEvent} event\r\n * @returns {void}\r\n */\nResizeObserverController.prototype.onTransitionEnd_ = function (ref) {\n        var propertyName = ref.propertyName; if ( propertyName === void 0 ) propertyName = '';\n\n    // Detect whether transition may affect dimensions of an element.\n    var isReflowProperty = transitionKeys.some(function (key) {\n        return !!~propertyName.indexOf(key);\n    });\n\n    if (isReflowProperty) {\n        this.refresh();\n    }\n};\n\n/**\r\n * Returns instance of the ResizeObserverController.\r\n *\r\n * @returns {ResizeObserverController}\r\n */\nResizeObserverController.getInstance = function () {\n    if (!this.instance_) {\n        this.instance_ = new ResizeObserverController();\n    }\n\n    return this.instance_;\n};\n\nResizeObserverController.instance_ = null;\n\n/**\r\n * Defines non-writable/enumerable properties of the provided target object.\r\n *\r\n * @param {Object} target - Object for which to define properties.\r\n * @param {Object} props - Properties to be defined.\r\n * @returns {Object} Target object.\r\n */\nvar defineConfigurable = (function (target, props) {\n    for (var i = 0, list = Object.keys(props); i < list.length; i += 1) {\n        var key = list[i];\n\n        Object.defineProperty(target, key, {\n            value: props[key],\n            enumerable: false,\n            writable: false,\n            configurable: true\n        });\n    }\n\n    return target;\n});\n\n/**\r\n * Returns the global object associated with provided element.\r\n *\r\n * @param {Object} target\r\n * @returns {Object}\r\n */\nvar getWindowOf = (function (target) {\n    // Assume that the element is an instance of Node, which means that it\n    // has the \"ownerDocument\" property from which we can retrieve a\n    // corresponding global object.\n    var ownerGlobal = target && target.ownerDocument && target.ownerDocument.defaultView;\n\n    // Return the local global object if it's not possible extract one from\n    // provided element.\n    return ownerGlobal || global$1;\n});\n\n// Placeholder of an empty content rectangle.\nvar emptyRect = createRectInit(0, 0, 0, 0);\n\n/**\r\n * Converts provided string to a number.\r\n *\r\n * @param {number|string} value\r\n * @returns {number}\r\n */\nfunction toFloat(value) {\n    return parseFloat(value) || 0;\n}\n\n/**\r\n * Extracts borders size from provided styles.\r\n *\r\n * @param {CSSStyleDeclaration} styles\r\n * @param {...string} positions - Borders positions (top, right, ...)\r\n * @returns {number}\r\n */\nfunction getBordersSize(styles) {\n    var positions = [], len = arguments.length - 1;\n    while ( len-- > 0 ) positions[ len ] = arguments[ len + 1 ];\n\n    return positions.reduce(function (size, position) {\n        var value = styles['border-' + position + '-width'];\n\n        return size + toFloat(value);\n    }, 0);\n}\n\n/**\r\n * Extracts paddings sizes from provided styles.\r\n *\r\n * @param {CSSStyleDeclaration} styles\r\n * @returns {Object} Paddings box.\r\n */\nfunction getPaddings(styles) {\n    var positions = ['top', 'right', 'bottom', 'left'];\n    var paddings = {};\n\n    for (var i = 0, list = positions; i < list.length; i += 1) {\n        var position = list[i];\n\n        var value = styles['padding-' + position];\n\n        paddings[position] = toFloat(value);\n    }\n\n    return paddings;\n}\n\n/**\r\n * Calculates content rectangle of provided SVG element.\r\n *\r\n * @param {SVGGraphicsElement} target - Element content rectangle of which needs\r\n *      to be calculated.\r\n * @returns {DOMRectInit}\r\n */\nfunction getSVGContentRect(target) {\n    var bbox = target.getBBox();\n\n    return createRectInit(0, 0, bbox.width, bbox.height);\n}\n\n/**\r\n * Calculates content rectangle of provided HTMLElement.\r\n *\r\n * @param {HTMLElement} target - Element for which to calculate the content rectangle.\r\n * @returns {DOMRectInit}\r\n */\nfunction getHTMLElementContentRect(target) {\n    // Client width & height properties can't be\n    // used exclusively as they provide rounded values.\n    var clientWidth = target.clientWidth;\n    var clientHeight = target.clientHeight;\n\n    // By this condition we can catch all non-replaced inline, hidden and\n    // detached elements. Though elements with width & height properties less\n    // than 0.5 will be discarded as well.\n    //\n    // Without it we would need to implement separate methods for each of\n    // those cases and it's not possible to perform a precise and performance\n    // effective test for hidden elements. E.g. even jQuery's ':visible' filter\n    // gives wrong results for elements with width & height less than 0.5.\n    if (!clientWidth && !clientHeight) {\n        return emptyRect;\n    }\n\n    var styles = getWindowOf(target).getComputedStyle(target);\n    var paddings = getPaddings(styles);\n    var horizPad = paddings.left + paddings.right;\n    var vertPad = paddings.top + paddings.bottom;\n\n    // Computed styles of width & height are being used because they are the\n    // only dimensions available to JS that contain non-rounded values. It could\n    // be possible to utilize the getBoundingClientRect if only it's data wasn't\n    // affected by CSS transformations let alone paddings, borders and scroll bars.\n    var width = toFloat(styles.width),\n        height = toFloat(styles.height);\n\n    // Width & height include paddings and borders when the 'border-box' box\n    // model is applied (except for IE).\n    if (styles.boxSizing === 'border-box') {\n        // Following conditions are required to handle Internet Explorer which\n        // doesn't include paddings and borders to computed CSS dimensions.\n        //\n        // We can say that if CSS dimensions + paddings are equal to the \"client\"\n        // properties then it's either IE, and thus we don't need to subtract\n        // anything, or an element merely doesn't have paddings/borders styles.\n        if (Math.round(width + horizPad) !== clientWidth) {\n            width -= getBordersSize(styles, 'left', 'right') + horizPad;\n        }\n\n        if (Math.round(height + vertPad) !== clientHeight) {\n            height -= getBordersSize(styles, 'top', 'bottom') + vertPad;\n        }\n    }\n\n    // Following steps can't be applied to the document's root element as its\n    // client[Width/Height] properties represent viewport area of the window.\n    // Besides, it's as well not necessary as the <html> itself neither has\n    // rendered scroll bars nor it can be clipped.\n    if (!isDocumentElement(target)) {\n        // In some browsers (only in Firefox, actually) CSS width & height\n        // include scroll bars size which can be removed at this step as scroll\n        // bars are the only difference between rounded dimensions + paddings\n        // and \"client\" properties, though that is not always true in Chrome.\n        var vertScrollbar = Math.round(width + horizPad) - clientWidth;\n        var horizScrollbar = Math.round(height + vertPad) - clientHeight;\n\n        // Chrome has a rather weird rounding of \"client\" properties.\n        // E.g. for an element with content width of 314.2px it sometimes gives\n        // the client width of 315px and for the width of 314.7px it may give\n        // 314px. And it doesn't happen all the time. So just ignore this delta\n        // as a non-relevant.\n        if (Math.abs(vertScrollbar) !== 1) {\n            width -= vertScrollbar;\n        }\n\n        if (Math.abs(horizScrollbar) !== 1) {\n            height -= horizScrollbar;\n        }\n    }\n\n    return createRectInit(paddings.left, paddings.top, width, height);\n}\n\n/**\r\n * Checks whether provided element is an instance of the SVGGraphicsElement.\r\n *\r\n * @param {Element} target - Element to be checked.\r\n * @returns {boolean}\r\n */\nvar isSVGGraphicsElement = (function () {\n    // Some browsers, namely IE and Edge, don't have the SVGGraphicsElement\n    // interface.\n    if (typeof SVGGraphicsElement !== 'undefined') {\n        return function (target) { return target instanceof getWindowOf(target).SVGGraphicsElement; };\n    }\n\n    // If it's so, then check that element is at least an instance of the\n    // SVGElement and that it has the \"getBBox\" method.\n    // eslint-disable-next-line no-extra-parens\n    return function (target) { return target instanceof getWindowOf(target).SVGElement && typeof target.getBBox === 'function'; };\n})();\n\n/**\r\n * Checks whether provided element is a document element (<html>).\r\n *\r\n * @param {Element} target - Element to be checked.\r\n * @returns {boolean}\r\n */\nfunction isDocumentElement(target) {\n    return target === getWindowOf(target).document.documentElement;\n}\n\n/**\r\n * Calculates an appropriate content rectangle for provided html or svg element.\r\n *\r\n * @param {Element} target - Element content rectangle of which needs to be calculated.\r\n * @returns {DOMRectInit}\r\n */\nfunction getContentRect(target) {\n    if (!isBrowser) {\n        return emptyRect;\n    }\n\n    if (isSVGGraphicsElement(target)) {\n        return getSVGContentRect(target);\n    }\n\n    return getHTMLElementContentRect(target);\n}\n\n/**\r\n * Creates rectangle with an interface of the DOMRectReadOnly.\r\n * Spec: https://drafts.fxtf.org/geometry/#domrectreadonly\r\n *\r\n * @param {DOMRectInit} rectInit - Object with rectangle's x/y coordinates and dimensions.\r\n * @returns {DOMRectReadOnly}\r\n */\nfunction createReadOnlyRect(ref) {\n    var x = ref.x;\n    var y = ref.y;\n    var width = ref.width;\n    var height = ref.height;\n\n    // If DOMRectReadOnly is available use it as a prototype for the rectangle.\n    var Constr = typeof DOMRectReadOnly !== 'undefined' ? DOMRectReadOnly : Object;\n    var rect = Object.create(Constr.prototype);\n\n    // Rectangle's properties are not writable and non-enumerable.\n    defineConfigurable(rect, {\n        x: x, y: y, width: width, height: height,\n        top: y,\n        right: x + width,\n        bottom: height + y,\n        left: x\n    });\n\n    return rect;\n}\n\n/**\r\n * Creates DOMRectInit object based on the provided dimensions and the x/y coordinates.\r\n * Spec: https://drafts.fxtf.org/geometry/#dictdef-domrectinit\r\n *\r\n * @param {number} x - X coordinate.\r\n * @param {number} y - Y coordinate.\r\n * @param {number} width - Rectangle's width.\r\n * @param {number} height - Rectangle's height.\r\n * @returns {DOMRectInit}\r\n */\nfunction createRectInit(x, y, width, height) {\n    return { x: x, y: y, width: width, height: height };\n}\n\n/**\r\n * Class that is responsible for computations of the content rectangle of\r\n * provided DOM element and for keeping track of it's changes.\r\n */\nvar ResizeObservation = function(target) {\n    this.broadcastWidth = 0;\n    this.broadcastHeight = 0;\n    this.contentRect_ = createRectInit(0, 0, 0, 0);\n\n    this.target = target;\n};\n\n/**\r\n * Updates content rectangle and tells whether it's width or height properties\r\n * have changed since the last broadcast.\r\n *\r\n * @returns {boolean}\r\n */\n\n\n/**\r\n * Reference to the last observed content rectangle.\r\n *\r\n * @private {DOMRectInit}\r\n */\n\n\n/**\r\n * Broadcasted width of content rectangle.\r\n *\r\n * @type {number}\r\n */\nResizeObservation.prototype.isActive = function () {\n    var rect = getContentRect(this.target);\n\n    this.contentRect_ = rect;\n\n    return rect.width !== this.broadcastWidth || rect.height !== this.broadcastHeight;\n};\n\n/**\r\n * Updates 'broadcastWidth' and 'broadcastHeight' properties with a data\r\n * from the corresponding properties of the last observed content rectangle.\r\n *\r\n * @returns {DOMRectInit} Last observed content rectangle.\r\n */\nResizeObservation.prototype.broadcastRect = function () {\n    var rect = this.contentRect_;\n\n    this.broadcastWidth = rect.width;\n    this.broadcastHeight = rect.height;\n\n    return rect;\n};\n\nvar ResizeObserverEntry = function(target, rectInit) {\n    var contentRect = createReadOnlyRect(rectInit);\n\n    // According to the specification following properties are not writable\n    // and are also not enumerable in the native implementation.\n    //\n    // Property accessors are not being used as they'd require to define a\n    // private WeakMap storage which may cause memory leaks in browsers that\n    // don't support this type of collections.\n    defineConfigurable(this, { target: target, contentRect: contentRect });\n};\n\nvar ResizeObserverSPI = function(callback, controller, callbackCtx) {\n    this.activeObservations_ = [];\n    this.observations_ = new MapShim();\n\n    if (typeof callback !== 'function') {\n        throw new TypeError('The callback provided as parameter 1 is not a function.');\n    }\n\n    this.callback_ = callback;\n    this.controller_ = controller;\n    this.callbackCtx_ = callbackCtx;\n};\n\n/**\r\n * Starts observing provided element.\r\n *\r\n * @param {Element} target - Element to be observed.\r\n * @returns {void}\r\n */\n\n\n/**\r\n * Registry of the ResizeObservation instances.\r\n *\r\n * @private {Map<Element, ResizeObservation>}\r\n */\n\n\n/**\r\n * Public ResizeObserver instance which will be passed to the callback\r\n * function and used as a value of it's \"this\" binding.\r\n *\r\n * @private {ResizeObserver}\r\n */\n\n/**\r\n * Collection of resize observations that have detected changes in dimensions\r\n * of elements.\r\n *\r\n * @private {Array<ResizeObservation>}\r\n */\nResizeObserverSPI.prototype.observe = function (target) {\n    if (!arguments.length) {\n        throw new TypeError('1 argument required, but only 0 present.');\n    }\n\n    // Do nothing if current environment doesn't have the Element interface.\n    if (typeof Element === 'undefined' || !(Element instanceof Object)) {\n        return;\n    }\n\n    if (!(target instanceof getWindowOf(target).Element)) {\n        throw new TypeError('parameter 1 is not of type \"Element\".');\n    }\n\n    var observations = this.observations_;\n\n    // Do nothing if element is already being observed.\n    if (observations.has(target)) {\n        return;\n    }\n\n    observations.set(target, new ResizeObservation(target));\n\n    this.controller_.addObserver(this);\n\n    // Force the update of observations.\n    this.controller_.refresh();\n};\n\n/**\r\n * Stops observing provided element.\r\n *\r\n * @param {Element} target - Element to stop observing.\r\n * @returns {void}\r\n */\nResizeObserverSPI.prototype.unobserve = function (target) {\n    if (!arguments.length) {\n        throw new TypeError('1 argument required, but only 0 present.');\n    }\n\n    // Do nothing if current environment doesn't have the Element interface.\n    if (typeof Element === 'undefined' || !(Element instanceof Object)) {\n        return;\n    }\n\n    if (!(target instanceof getWindowOf(target).Element)) {\n        throw new TypeError('parameter 1 is not of type \"Element\".');\n    }\n\n    var observations = this.observations_;\n\n    // Do nothing if element is not being observed.\n    if (!observations.has(target)) {\n        return;\n    }\n\n    observations.delete(target);\n\n    if (!observations.size) {\n        this.controller_.removeObserver(this);\n    }\n};\n\n/**\r\n * Stops observing all elements.\r\n *\r\n * @returns {void}\r\n */\nResizeObserverSPI.prototype.disconnect = function () {\n    this.clearActive();\n    this.observations_.clear();\n    this.controller_.removeObserver(this);\n};\n\n/**\r\n * Collects observation instances the associated element of which has changed\r\n * it's content rectangle.\r\n *\r\n * @returns {void}\r\n */\nResizeObserverSPI.prototype.gatherActive = function () {\n        var this$1 = this;\n\n    this.clearActive();\n\n    this.observations_.forEach(function (observation) {\n        if (observation.isActive()) {\n            this$1.activeObservations_.push(observation);\n        }\n    });\n};\n\n/**\r\n * Invokes initial callback function with a list of ResizeObserverEntry\r\n * instances collected from active resize observations.\r\n *\r\n * @returns {void}\r\n */\nResizeObserverSPI.prototype.broadcastActive = function () {\n    // Do nothing if observer doesn't have active observations.\n    if (!this.hasActive()) {\n        return;\n    }\n\n    var ctx = this.callbackCtx_;\n\n    // Create ResizeObserverEntry instance for every active observation.\n    var entries = this.activeObservations_.map(function (observation) {\n        return new ResizeObserverEntry(observation.target, observation.broadcastRect());\n    });\n\n    this.callback_.call(ctx, entries, ctx);\n    this.clearActive();\n};\n\n/**\r\n * Clears the collection of active observations.\r\n *\r\n * @returns {void}\r\n */\nResizeObserverSPI.prototype.clearActive = function () {\n    this.activeObservations_.splice(0);\n};\n\n/**\r\n * Tells whether observer has active observations.\r\n *\r\n * @returns {boolean}\r\n */\nResizeObserverSPI.prototype.hasActive = function () {\n    return this.activeObservations_.length > 0;\n};\n\n// Registry of internal observers. If WeakMap is not available use current shim\n// for the Map collection as it has all required methods and because WeakMap\n// can't be fully polyfilled anyway.\nvar observers = typeof WeakMap !== 'undefined' ? new WeakMap() : new MapShim();\n\n/**\r\n * ResizeObserver API. Encapsulates the ResizeObserver SPI implementation\r\n * exposing only those methods and properties that are defined in the spec.\r\n */\nvar ResizeObserver = function(callback) {\n    if (!(this instanceof ResizeObserver)) {\n        throw new TypeError('Cannot call a class as a function.');\n    }\n    if (!arguments.length) {\n        throw new TypeError('1 argument required, but only 0 present.');\n    }\n\n    var controller = ResizeObserverController.getInstance();\n    var observer = new ResizeObserverSPI(callback, controller, this);\n\n    observers.set(this, observer);\n};\n\n// Expose public methods of ResizeObserver.\n['observe', 'unobserve', 'disconnect'].forEach(function (method) {\n    ResizeObserver.prototype[method] = function () {\n        return (ref = observers.get(this))[method].apply(ref, arguments);\n        var ref;\n    };\n});\n\nvar index = (function () {\n    // Export existing implementation if available.\n    if (typeof global$1.ResizeObserver !== 'undefined') {\n        return global$1.ResizeObserver;\n    }\n\n    return ResizeObserver;\n})();\n\nexport default index;\n","import m from \"mithril\";\nimport stream from \"mithril/stream\";\nimport ResizeObserver from \"resize-observer-polyfill\";\nimport { getElementSize, makeClassName } from \"./util\";\n\nconst getPageData = url =>\n  m.request({\n    method: \"GET\",\n    url\n  });\n\nconst oninit = ({ state, attrs }) => {\n  const pageNum = attrs.pageNum;\n  let content = stream([]);\n\n  if (attrs.pageData) {\n    const result = attrs.pageData(pageNum);\n    Promise.resolve(result).then(content).then(m.redraw);\n  } else if (attrs.pageUrl) {\n    const url = attrs.pageUrl(pageNum);\n    getPageData(url).then(content);\n  }\n\n  const processPageData = attrs.processPageData || ((content, attrs1) =>\n    content && content.length\n      ? content.map((data, index) => attrs.item(data, attrs1, index))\n      : null\n  );\n\n  state.content = content;\n  // Memoize some properties that do not change\n  state.className = makeClassName(pageNum);\n  state.pageTag = attrs.pageTag || \"div\";\n  state.processPageData = processPageData;\n};\n\nconst view = ({state, attrs}) => {\n  const pageId = attrs.pageId;\n  const storedPageSize = attrs.pageSizes[pageId] || 0;\n  let pageSize = 0;\n\n  // attrs/pageSize overrides all measurements on elements here\n  if (attrs.pageSize) {\n    pageSize = attrs.pageSize(state.content());\n    attrs.updatePageSize(pageId, pageSize);\n  }\n\n  const cssSize = pageSize\n    ? pageSize + \"px\"\n    : !attrs.autoSize\n      ? storedPageSize + \"px\"\n      : \"auto\";\n\n  const update = dom => {\n    if (pageSize) return;\n    const size = getElementSize(dom, attrs.axis);\n    if (size) {\n      attrs.updatePageSize(pageId, size);\n    }\n  };\n\n  return m(state.pageTag, {\n    \"data-page\": pageId,\n    class: state.className,\n    style: storedPageSize\n      ? attrs.axis === \"x\"\n        ? { width: cssSize }\n        : { height: cssSize }\n      : null,\n    oncreate: ({ dom }) => {\n      const ro = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const { width, height } = entry.contentRect;\n          if (\n            (attrs.axis === \"x\" && width !== storedPageSize)\n            || (attrs.axis === \"y\" && height !== storedPageSize)\n          ) {\n            update(dom);\n          }\n        }\n      });\n      ro.observe(dom);\n      // update(dom);\n    },\n    onupdate: ({ dom }) => update(dom)\n  }, state.processPageData(state.content(), {\n    pageId: attrs.pageId,\n    pageNum: attrs.pageNum\n  }));\n};\n\nexport const page = {\n  oninit,\n  view\n};\n","import m from \"mithril\";\nimport { makeClassName } from \"./util\";\nimport { classes } from \"./classes\";\n\nexport const placeholder = {\n  oninit: vnode =>\n    // Memoize some properties that do not change\n    vnode.state.className = makeClassName(vnode.attrs.pageNum),\n  view: ({ state, attrs }) => {\n    const pageId = attrs.pageId;\n    const storedPageSize = attrs.pageSizes[pageId] || 0;\n\n    return m(\"div\", {\n      \"data-page\": pageId,\n      class: [\n        classes.placeholder,\n        state.className\n      ].join(\" \"),\n      style: Object.assign(\n        {},\n        attrs.axis === \"x\"\n          ? { width:  storedPageSize + \"px\" }\n          : { height: storedPageSize + \"px\" }\n      )\n    });\n  }\n};\n","'use strict';\n\nvar emptyArray = [];\nvar emptyObject = {};\nvar type = emptyObject.toString;\nvar ARRAY =  type.call(emptyArray);\nvar OBJECT = type.call(emptyObject);\nvar STRING = type.call('');\nvar FUNCTION = type.call(type);\nvar own =  emptyObject.hasOwnProperty;\nvar freeze = Object.freeze || function(o) {return o};\n\n\nfunction defaults(target, source) {\n  for (var k in source) if (own.call(source, k)) {\n    if (k.indexOf('$') && !(k in target)) target[k] = source[k];\n  }\n  return target\n}\n\nfunction cartesian(a,b) {\n  var res = [], i, j;\n  for (j in b) if(own.call(b, j))\n    for (i in a) if(own.call(a, i))\n      res.push(a[i] + b[j]);\n  return res\n}\n\n// \"Tokenizes\" the selectors into parts relevant for the next function.\n// Strings and comments are matched, but ignored afterwards.\n// This is not a full tokenizers. It only recognizes comas, parentheses,\n// strings and comments.\n// regexp generated by scripts/regexps.js then trimmed by hand\nvar selectorTokenizer = /[(),]|\"(?:\\\\.|[^\"\\n])*\"|'(?:\\\\.|[^'\\n])*'|\\/\\*[\\s\\S]*?\\*\\//g;\n\n\n/**\n * This will split a coma-separated selector list into individual selectors,\n * ignoring comas in strings, comments and in :pseudo-selectors(parameter, lists).\n *\n * @param {string} selector\n * @return {string[]}\n */\n\nfunction splitSelector(selector) {\n  var indices = [], res = [], inParen = 0, o;\n  /*eslint-disable no-cond-assign*/\n  while (o = selectorTokenizer.exec(selector)) {\n  /*eslint-enable no-cond-assign*/\n    switch (o[0]) {\n    case '(': inParen++; break\n    case ')': inParen--; break\n    case ',': if (inParen) break; indices.push(o.index);\n    }\n  }\n  for (o = indices.length; o--;){\n    res.unshift(selector.slice(indices[o] + 1));\n    selector = selector.slice(0, indices[o]);\n  }\n  res.unshift(selector);\n  return res\n}\n\n// Like the `selectorTokenizer`, but for the `&` operator\nvar ampersandTokenizer = /&|\"(?:\\\\.|[^\"\\n])*\"|'(?:\\\\.|[^'\\n])*'|\\/\\*[\\s\\S]*?\\*\\//g;\n\nfunction ampersand (selector, parents) {\n  var indices = [], split = [], res, o;\n  /*eslint-disable no-cond-assign*/\n  while (o = ampersandTokenizer.exec(selector)) {\n  /*eslint-enable no-cond-assign*/\n    if (o[0] == '&') indices.push(o.index);\n  }\n  for (o = indices.length; o--;){\n    split.unshift(selector.slice(indices[o] + 1));\n    selector = selector.slice(0, indices[o]);\n  }\n  split.unshift(selector);\n  if (split.length === 1) split.unshift('');\n  res = [split[0]];\n  for (o = 1; o < split.length; o++) {\n    res = cartesian(res, cartesian(parents, [split[o]]));\n  }\n  return res.join(',')\n}\n\nfunction flatIter (f) {\n  return function iter(arg) {\n    if (type.call(arg) === ARRAY) for (var i= 0 ; i < arg.length; i ++) iter(arg[i]);\n    else f(arg);\n  }\n}\n\nfunction decamelize(match) {\n  return '-' + match.toLowerCase()\n}\n\n/**\n * Handles the property:value; pairs.\n *\n * @param {object} state - holds the localizer- and walker-related methods\n *                         and state\n * @param {object} emit - the contextual emitters to the final buffer\n * @param {string} prefix - the current property or a prefix in case of nested\n *                          sub-properties.\n * @param {array|object|string} o - the declarations.\n * @param {boolean} local - are we in @local or in @global scope.\n */\n\nfunction declarations(state, emit, prefix, o, local) {\n  var k, v, kk;\n  if (o==null) return\n\n  switch ( type.call(o = o.valueOf()) ) {\n  case ARRAY:\n    for (k = 0; k < o.length; k++)\n\n      declarations(state, emit, prefix, o[k], local);\n\n    break\n  case OBJECT:\n    // prefix is falsy iif it is the empty string, which means we're at the root\n    // of the declarations list.\n    prefix = (prefix && prefix + '-');\n    for (k in o) if (own.call(o, k)){\n      v = o[k];\n      if (/\\$/.test(k)) {\n        for (kk in (k = k.split('$'))) if (own.call(k, kk)) {\n\n          declarations(state, emit, prefix + k[kk], v, local);\n\n        }\n      } else {\n\n        declarations(state, emit, prefix + k, v, local);\n\n      }\n    }\n    break\n  default:\n    // prefix is falsy when it is \"\", which means that we're\n    // at the top level.\n    // `o` is then treated as a `property:value` pair, or a\n    // semi-colon-separated list thereof.\n    // Otherwise, `prefix` is the property name, and\n    // `o` is the value.\n\n    // restore the dashes\n    k = prefix.replace(/_/g, '-').replace(/[A-Z]/g, decamelize);\n\n    if (local && (k == 'animation-name' || k == 'animation' || k == 'list-style')) {\n      // no need to tokenize here a plain `.split(',')` has all bases covered.\n      // We may 'localize' a comment, but it's not a big deal.\n      o = o.split(',').map(function (o) {\n\n        return o.replace(/^\\s*(?:(var\\([^)]+\\))|:?global\\(\\s*([_A-Za-z][-\\w]*)\\s*\\)|()(-?[_A-Za-z][-\\w]*))/, state.localizeReplacer)\n\n      }).join(',');\n    }\n\n    emit.decl(k, o);\n\n  }\n}\n\n/**\n * Handles a single at-rules\n *\n * @param {object} state - holds the localizer- and walker-related methods\n *                         and state\n * @param {object} emit - the contextual emitters to the final buffer\n * @param {array} k - The parsed at-rule, including the parameters,\n *                    if takes both parameters and a block.\n *                    k == [match, fullAtRule, atRuleType, params?]\n *                    So in `@-webkit-keyframes foo`, we have\n *                     - match = \"@-webkit-keyframes foo\"\n *                     - fullAtRule = \"@-webkit-keyframes\"\n *                     - atRuleType = \"keyframes\"\n *                     - params = \"foo\"\n * @param {string|string[]|object|object[]} v - Either parameters for\n *                                              block-less rules or\n *                                              their block\n *                                              for the others.\n * @param {string} prefix - the current selector or the selector prefix\n *                          in case of nested rules\n * @param {boolean} local - are we in @local or in @global scope?\n * @param {string} nestingDepth - are we nested in an at-rule or a selector?\n */\n\nfunction atRules(state, emit, k, v, prefix, local, nestingDepth) {\n\n  // First iterate over user-provided at-rules and return if one of them corresponds to the current one\n  for (var i = 0; i < state.$atHandlers.length; i++) {\n\n    if (state.$atHandlers[i](state, emit, k, v, prefix, local, nestingDepth)) return\n\n  }\n\n  // using `/^global$/.test(k[2])` rather that 'global' == k[2] gzips\n  // slightly better thanks to the regexps tests further down.\n  // It is slightly less efficient but this isn't a critical path.\n\n  if (!k[3] && /^global$/.test(k[2])) {\n\n    rules(state, emit, prefix, v, 0, nestingDepth);\n\n\n  } else if (!k[3] && /^local$/.test(k[2])) {\n\n    rules(state, emit, prefix, v, 1, nestingDepth);\n\n\n  } else if (k[3] && /^adopt$/.test(k[2])) {\n\n    if (!local || nestingDepth) return emit.err('@adopt global or nested: ' + k[0])\n\n    if (!/^\\.?[_A-Za-z][-\\w]*$/.test(k[3])) return emit.err('bad adopter ' + JSON.stringify(k[3]) + ' in ' + k[0])\n\n    i = [];\n    flatIter(function(adoptee, asString) {\n\n      if(adoptee == null || !/^\\.?[_A-Za-z][-\\w]*(?:\\s+\\.?[_A-Za-z][-\\w]*)*$/.test(asString = adoptee + '')) emit.err('bad adoptee '+ JSON.stringify(adoptee) + ' in ' + k[0]);\n\n      else i.push(asString.replace(/\\./g, ''));\n\n    })(v);\n\n    // we may end up with duplicate classes but AFAIK it has no consequences on specificity.\n    if (i.length) {\n      state.localize(k[3] = k[3].replace(/\\./g, ''));\n      state.names[k[3]] += (' ' + i.join(' '));\n    }\n\n\n  } else if (!k[3] && /^(?:namespace|import|charset)$/.test(k[2])) {\n    flatIter(function(v) {\n\n      emit.atrule(k[1], k[2], v);\n\n    })(v);\n\n\n  } else if (!k[3] && /^(?:font-face|viewport)$/.test(k[2])) {\n    flatIter(function(v) {\n\n      emit.atrule(k[1], k[2], k[3], 1);\n\n      declarations(state, emit, '', v, local);\n\n      emit._atrule();\n\n    })(v);\n\n  } else if (k[3] && /^(?:media|supports|page|keyframes)$/.test(k[2])) {\n\n    if (local && 'keyframes' == k[2]) {\n      k[3] = k[3].replace(\n        // generated by script/regexps.js\n        /(var\\([^)]+\\))|:?global\\(\\s*([_A-Za-z][-\\w]*)\\s*\\)|()(-?[_A-Za-z][-\\w]*)/,\n        state.localizeReplacer\n      );\n    }\n\n\n    emit.atrule(k[1], k[2], k[3], 1);\n\n    if ('page' == k[2]) {\n\n      declarations(state, emit, '', v, local);\n\n    } else {\n\n      rules(\n        state, emit,\n        'keyframes' == k[2] ? '' : prefix,\n        v, local, nestingDepth + 1\n      );\n\n    }\n\n    emit._atrule();\n\n  } else {\n\n    emit.err('Unsupported at-rule: ' + k[0]);\n\n  }\n}\n\n/**\n * Add rulesets and other CSS tree to the sheet.\n *\n * @param {object} state - holds the localizer- and walker-related methods\n *                         and state\n * @param {object} emit - the contextual emitters to the final buffer\n * @param {string} prefix - the current selector or a prefix in case of nested rules\n * @param {array|string|object} tree - a source object or sub-object.\n * @param {string} nestingDepth - are we nested in an at-rule?\n * @param {boolean} local - are we in @local or in @global scope?\n */\nfunction rules(state, emit, prefix, tree, local, nestingDepth) {\n  var k, v, inDeclaration, kk;\n\n  switch (type.call(tree)) {\n\n  case OBJECT:\n    for (k in tree) if (own.call(tree, k)) {\n      v = tree[k];\n\n      if (prefix.length > 0 && /^[-\\w$]+$/.test(k)) {\n        if (!inDeclaration) {\n          inDeclaration = 1;\n\n          emit.rule(prefix);\n\n        }\n        if (/\\$/.test(k)) {\n          for (kk in (k = k.split('$'))) if (own.call(k, kk)) {\n\n            declarations(state, emit, k[kk], v, local);\n\n          }\n        } else {\n\n          declarations(state, emit, k, v, local);\n\n        }\n\n      } else if (/^@/.test(k)) {\n        // Handle At-rules\n        inDeclaration = 0;\n\n        atRules(state, emit,\n          /^(.(?:-[\\w]+-)?([_A-Za-z][-\\w]*))\\b\\s*(.*?)\\s*$/.exec(k) || [k,'@','',''],\n          v, prefix, local, nestingDepth\n        );\n\n      } else {\n        // selector or nested sub-selectors\n        inDeclaration = 0;\n\n        rules(\n          state, emit,\n          // build the selector `prefix` for the next iteration.\n          // ugly and full of redundant bits but so far the fastest/shortest.gz\n          /*0 if*/(prefix.length > 0 && (/,/.test(prefix) || /,/.test(k))) ?\n\n            /*0 then*/ (kk = splitSelector(prefix), splitSelector(\n              local ?\n\n                k.replace(\n                  /(\"(?:\\\\.|[^\"\\n])*\"|'(?:\\\\.|[^'\\n])*'|\\/\\*[\\s\\S]*?\\*\\/)|:global\\(\\s*(\\.-?[_A-Za-z][-\\w]*)\\s*\\)|(\\.)(-?[_A-Za-z][-\\w]*)/g,\n                  state.localizeReplacer\n                ) :\n\n                k\n            ).map(function (k) {\n              return /&/.test(k) ? ampersand(k, kk) : kk.map(function(kk) {\n                return kk + k\n              }).join(',')\n            }).join(',')) :\n\n            /*0 else*/ /*1 if*/ /&/.test(k) ?\n\n              /*1 then*/ ampersand(\n                local ?\n\n                  k.replace(\n                    /(\"(?:\\\\.|[^\"\\n])*\"|'(?:\\\\.|[^'\\n])*'|\\/\\*[\\s\\S]*?\\*\\/)|:global\\(\\s*(\\.-?[_A-Za-z][-\\w]*)\\s*\\)|(\\.)(-?[_A-Za-z][-\\w]*)/g,\n                    state.localizeReplacer\n                  ) :\n\n                  k,\n                [prefix]\n              ) :\n\n              /*1 else*/ prefix + (\n                local ?\n\n                  k.replace(\n                    /(\"(?:\\\\.|[^\"\\n])*\"|'(?:\\\\.|[^'\\n])*'|\\/\\*[\\s\\S]*?\\*\\/)|:global\\(\\s*(\\.-?[_A-Za-z][-\\w]*)\\s*\\)|(\\.)(-?[_A-Za-z][-\\w]*)/g,\n                    state.localizeReplacer\n                  ) :\n\n                  k\n                ),\n           v, local, nestingDepth + 1\n        );\n\n      }\n    }\n\n    break\n\n  case ARRAY:\n    for (k = 0; k < tree.length; k++){\n\n      rules(state, emit, prefix, tree[k], local, nestingDepth);\n\n    }\n    break\n\n  case STRING:\n    // CSS hacks or ouptut of `j2c.inline`.\n    if (!prefix.length) emit.err('No selector');\n    emit.rule(prefix || ' ');\n\n    declarations(state, emit, '', tree, local);\n\n  }\n}\n\n// This is the first entry in the filters array, which is\n// actually the last step of the compiler. It inserts\n// closing braces to close normal (non at-) rules (those\n// that start with a selector). Doing it earlier is\n// impossible without passing state around in unrelated code\n// or ending up with duplicated selectors when the source tree\n// contains arrays.\n// There's no `_rule` handler, because the core compiler never\n// calls it.\nfunction closeSelectors(next, inline) {\n  var lastSelector;\n  return inline ? next : {\n    init: function(){lastSelector = 0; next.init();},\n    done: function (raw) {\n      if (lastSelector) {next._rule(); lastSelector = 0;}\n      return next.done(raw)\n    },\n    atrule: function (rule, kind, param, takesBlock) {\n      if (lastSelector) {next._rule(); lastSelector = 0;}\n      next.atrule(rule, kind, param, takesBlock);\n    },\n    _atrule: function (rule) {\n      if (lastSelector) {next._rule(); lastSelector = 0;}\n      next._atrule(rule);\n    },\n    rule: function (selector) {\n      if (selector !== lastSelector){\n        if (lastSelector) next._rule();\n        next.rule(selector);\n        lastSelector = selector;\n      }\n    }\n  }\n}\n\nfunction global(x) {\n  return ':global(' + x + ')'\n}\n\nfunction kv (k, v, o) {\n  o = {};\n  o[k] = v;\n  return o\n}\n\nfunction at (rule, params, block) {\n  if (\n    arguments.length < 3\n  ) {\n    // inner curry!\n    var _at = at.bind.apply(at, [null].concat([].slice.call(arguments,0)));\n    // So that it can be used as a key in an ES6 object literal.\n    _at.toString = function(){return '@' + rule + ' ' + params};\n    return _at\n  }\n  else return kv('@' + rule +' ' + params, block)\n}\n\nfunction j2c() {\n\n  // the buffer that accumulates the output. Initialized in `$sink.i()`\n  var buf, err;\n\n  // the bottom of the 'codegen' stream. Mirrors the `$filter` plugin API.\n  var $sink = {\n    init: function(){buf=[], err=[];},\n    done: function (raw) {\n      if (err.length != 0) throw new Error('j2c error(s): ' + JSON.stringify(err,null,2) + 'in context:\\n' + buf.join(''))\n      return raw ? buf : buf.join('')\n    },\n    err: function(msg) {\n      err.push(msg);\n      buf.push('/* +++ ERROR +++ ' + msg + ' */\\n');\n    },\n    atrule: function (rule, kind, param, takesBlock) {\n      buf.push(rule, param && ' ', param, takesBlock ? ' {' : ';', _instance.endline);\n    },\n    // close atrule\n    _atrule: function () {buf.push('}', _instance.endline);},\n    rule: function (selector) {buf.push(selector, ' {', _instance.endline);},\n    // close rule\n    _rule: function () {buf.push('}', _instance.endline);},\n    decl: function (prop, value) {buf.push(prop, prop && ':', value, ';', _instance.endline);}\n  };\n\n  // holds the `$filter` and `$at` handlers\n  var $filters = [closeSelectors];\n  var $atHandlers = [];\n\n  // the public API (see the main docs)\n  var _instance = {\n    at: at,\n    global: global,\n    kv: kv,\n    names: {},\n    endline: '\\n',\n    suffix: '__j2c-' +\n      // 128 bits of randomness\n      Math.floor(Math.random() * 0x100000000).toString(36) + '-' +\n      Math.floor(Math.random() * 0x100000000).toString(36) + '-' +\n      Math.floor(Math.random() * 0x100000000).toString(36) + '-' +\n      Math.floor(Math.random() * 0x100000000).toString(36),\n    $plugins: [],\n    sheet: function(tree) {\n      var emit = _createOrRetrieveStream(0);\n      emit.init();\n      rules(\n        _walkers[0],\n        emit,\n        '', // prefix\n        tree,\n        1,  // local, by default\n        0   // nesting depth\n      );\n\n      return emit.done()\n    },\n    inline: function (tree, options) {\n      var emit = _createOrRetrieveStream(1);\n      emit.init();\n      declarations(\n        _walkers[1],\n        emit,\n        '', // prefix\n        tree,\n        !(options && options.global)   // local, by default\n      );\n      return emit.done()\n    }\n  };\n\n  // The `state` (for the core functions) / `walker` (for the plugins) tables.\n  var _walkers = [\n    // for j2c.sheet\n    {\n      // helpers for locaizing class and animation names\n      localizeReplacer: _localizeReplacer, // second argument to String.prototype.replace\n      localize: _localize,                 // mangles local names\n      names: _instance.names,              // local => mangled mapping\n      $atHandlers: $atHandlers,            // extra at-rules\n      // The core walker methods, to be provided to plugins\n      atrule: atRules,\n      decl: declarations,\n      rule: rules\n    },\n    // likewise, for j2c.inline (idem with `$a`, `a` and `s` removed)\n    {\n      localizeReplacer: _localizeReplacer,\n      localize: _localize,\n      names: _instance.names,\n      decl: declarations\n    }\n  ];\n\n\n  // inner helpers\n\n  var _use = flatIter(function(plugin) {\n    // `~n` is falsy for `n === -1` and truthy otherwise.\n    // Works well to turn the  result of `a.indexOf(x)`\n    // into a value that reflects the presence of `x` in\n    // `a`.\n    if (~_instance.$plugins.indexOf(plugin)) return\n\n    _instance.$plugins.push(plugin);\n\n    if (type.call(plugin) === FUNCTION) plugin = plugin(_instance);\n\n    if (!plugin) return\n\n    flatIter(function(filter) {\n      $filters.push(filter);\n    })(plugin.$filter || emptyArray);\n\n    flatIter(function(handler) {\n      $atHandlers.push(handler);\n    })(plugin.$at || emptyArray);\n\n    defaults(_instance.names, plugin.$names || emptyObject);\n\n    _use(plugin.$plugins || emptyArray);\n\n    $sink = plugin.$sink || $sink;\n\n    defaults(_instance, plugin);\n  });\n\n\n  var _streams = [];\n  /**\n   * returns the codegen streams, creating them if necessary\n   * @param\n   */\n  function _createOrRetrieveStream(inline) {\n    // build the stream processors if needed\n    if (!_streams.length) {\n      // append the $sink as the ultimate filter\n      $filters.push(function(_, inline) {return inline ? {init:$sink.init, decl:$sink.decl, done:$sink.done, err: $sink.err} : $sink});\n      for(var i = 0; i < 2; i++){ // 0 for j2c.sheet, 1 for j2c.inline\n        for (var j = $filters.length; j--;) {\n          _streams[i] = freeze(\n            defaults(\n              $filters[j](_streams[i], !!i),\n              _streams[i]\n            )\n          );\n        }\n      }\n    }\n    return _streams[inline]\n  }\n\n  /**\n   * Returns a localized version of a given name.\n   * Registers the pair in `instnace.name` if needed.\n   *\n   * @param {string} name - the name to localize\n   * @return {string} - the localized version\n   */\n  function _localize(name) {\n    if (!_instance.names[name]) _instance.names[name] = name + _instance.suffix;\n    return _instance.names[name].match(/^\\S+/)\n  }\n\n  /**\n   * Used as second argument for str.replace(localizeRegex, replacer)\n   * `ignore`, `global` and `(dot, name)` are mutually exclusive\n   *\n   * @param {string} match - the whole match (ignored)\n   * @param {string|null} ignore - a comment or a string literal\n   * @param {string|null} global - a global name\n   * @param {string|null} dot - either '.' for a local class name or the empty string otherwise\n   * @param {string|null} name - the name to localize\n   * @return {string}\n   */\n  function _localizeReplacer(match, ignore, global$$1, dot, name) {\n    return ignore || global$$1 || dot + _localize(name)\n  }\n\n  _use(emptyArray.slice.call(arguments));\n  return _instance\n}\n\nmodule.exports = j2c;\n","import J2c from \"j2c\";\nconst j2c = new J2c();\n\n/*\n * @param id: identifier, used as HTMLElement id for the attached <style></style> element\n * @param styles: list of lists style Objects\n */\nexport const addStyle = (id, ...styles) => {\n  removeStyle(id);\n  const styleEl = document.createElement(\"style\");\n  if (id) {\n    styleEl.setAttribute(\"id\", id);\n  }\n  styles.forEach((styleList) => {\n    // each style returns a list\n    if (Object.keys(styleList).length) {\n      styleList.forEach((style) => {\n        const scoped = { \"@global\": style };\n        const sheet = j2c.sheet(scoped);\n        styleEl.appendChild(document.createTextNode(sheet));\n      });\n    }\n  });\n  document.head.appendChild(styleEl);\n};\n\nconst removeStyle = id => {\n  if (id) {\n    const old = document.getElementById(id);\n    if (old) {\n      old.parentNode.removeChild(old);\n    }\n  }\n};","import { addStyle } from \"./styler\";\nimport { classes } from \"./classes\";\n\nconst styles = [{\n  [\".\" + classes.scrollView]: {\n    \"-webkit-overflow-scrolling\": \"touch\",\n    height: \"100%\",\n\n    [\" .\" + classes.scrollContent]: {\n      overflowAnchor: \"none\",\n    },\n\n    [\"&.\" + classes.scrollViewY]: {\n      overflowX: \"hidden\",\n      overflowY: \"auto\",\n      height: \"100%\",\n\n      [\" .\" + classes.scrollContent]: {\n        height: \"100%\",\n      }\n    },\n\n    [\"&.\" + classes.scrollViewX]: {\n      overflowX: \"auto\",\n      overflowY: \"hidden\",\n      width: \"100%\",\n\n      [\" .\" + classes.scrollContent]: {\n        width: \"100%\"\n      }\n    }\n  }\n  // by default unstyled:\n  // mithril-infinite__content\n  // mithril-infinite__pages\n  // mithril-infinite__page\n}];\n\naddStyle(\"mithril-infinite\", styles);\n","import m from \"mithril\";\nimport { classes } from \"./classes\";\nimport { getElementSize, isElementInViewport } from \"./util\";\nimport { page } from \"./page\";\nimport { placeholder } from \"./placeholder\";\nimport \"./css\";\n\nconst SEL_PADDING = \"000000\";\n\nconst numToId = pageNum =>\n  SEL_PADDING.substring(0, SEL_PADDING.length - (\"\" + pageNum).length) + pageNum;\n\nconst calculateCurrentPageNum = (scrollAmount, state) => {\n  const pageNumKeys = state.sortedKeys;\n  if (pageNumKeys.length === 0) {\n    return 1;\n  }\n  let acc = state.beforeSize || 0;\n  let currentPageNum = 1;\n  for (let i = 0; i < pageNumKeys.length; i = i + 1) {\n    let pageKey = pageNumKeys[i];\n    if (scrollAmount > acc) {\n      currentPageNum = parseInt(pageKey, 10);\n    }\n    acc += state.pageSizes[pageKey];\n  }\n  return currentPageNum;\n};\n\nconst calculateContentSize = (from, to, state) => {\n  const fromIndex = Math.max(0, from - 1);\n  if (to < fromIndex) {\n    return 0;\n  }\n  const toIndex = to;\n  const pageNumKeys = state.sortedKeys.slice(fromIndex, toIndex);\n  let size = state.beforeSize || 0;\n  size = pageNumKeys.reduce((total, pageKey) => (\n    total += state.pageSizes[pageKey] || 0\n  ), size);\n  size += state.afterSize || 0;\n  return size;\n};\n\nconst isPageInViewport = (page, axis, state, scrollView) => {\n  if (!scrollView) {\n    return false;\n  }\n  const id = numToId(page);\n  const el = scrollView.querySelector(`[data-page=\"${id}\"]`);\n  return isElementInViewport({ el, axis });\n};\n\nconst updatePageSize = state => (pageId, size) => {\n  const oldSize = state.pageSizes[pageId];\n  const newSize = parseInt(size, 10);\n  if (oldSize !== newSize) {\n    state.pageSizes[pageId] = newSize;\n    state.sortedKeys = Object.keys(state.pageSizes).sort();\n    calculatePreloadSlots(state);\n    setTimeout(m.redraw, 0);\n  }\n};\n\nconst updatePart = (dom, whichSize, state, axis) => {\n  const size = getElementSize(dom, axis);\n  if (size) {\n    state[whichSize] = size;\n  }\n};\n\nconst calculatePreloadSlots = state => {\n  if (!state.scrollView) return;\n  const boundingClientRect = state.scrollView.getBoundingClientRect();\n  state.boundingClientRect = state.boundingClientRect || boundingClientRect;\n  if (boundingClientRect.width !== state.boundingClientRect.width\n    || boundingClientRect.height !== state.boundingClientRect.height\n  ) {\n    state.preloadSlots = state.attrsPreloadSlots || 1;\n  }\n  state.boundingClientRect = boundingClientRect;\n\n  // calculate if we have room on the screen to show more slots\n  if (state.contentSize\n    && (state.preloadSlots < state.pageCount)\n    && (state.preloadSlots <= state.attrsMaxPreloadSlots)\n    && (state.contentSize < boundingClientRect.height)\n  ) {\n    state.preloadSlots++;\n    setTimeout(m.redraw, 0);\n  }\n};\n\nconst getPageList = (currentPageNum, fromPage, toPage, currentPage, preloadSlots, maxPages) => {\n  const minPageNum = fromPage\n    ? parseInt(fromPage, 10)\n    : currentPage\n      ? currentPage\n      : 1;\n  const maxPageNum = toPage\n    ? parseInt(toPage, 10)\n    : currentPage\n      ? currentPage\n      : maxPages;\n  const pages = [];\n  const prePages = [];\n  for (let i = -preloadSlots; i <= preloadSlots; i = i + 1) {\n    const pageNum = currentPageNum + i;\n    if (pageNum >= minPageNum && pageNum <= maxPageNum) {\n      pages.push(pageNum);\n    }\n  }\n  for (let pageNum = 1; pageNum < pages[0]; pageNum = pageNum + 1) {\n    prePages.push(pageNum);\n  }\n  return {pages, prePages, maxPageNum};\n};\n\nconst oninit = vnode => {\n  const attrs = vnode.attrs;\n  // Memoize some properties that do not change\n  const axis = attrs.axis || \"y\";\n  const whichScroll = axis === \"x\" ? \"scrollLeft\" : \"scrollTop\";\n  const autoSize = (attrs.autoSize !== undefined && attrs.autoSize === false) ? false : true;\n  const pageSize = attrs.pageSize;\n  const contentTag = attrs.contentTag || \"div\";\n  const classList = [\n    classes.scrollView,\n    axis === \"x\"\n      ? classes.scrollViewX\n      : classes.scrollViewY,\n    attrs.class\n  ].join(\" \");\n\n  const scroll = () => m.redraw();\n\n  vnode.state = {\n    afterSize: null,\n    beforeSize: null,\n    boundingClientRect: {},\n    currentPageNum: 0,\n    pageSizes: {},\n    preloadSlots: attrs.preloadPages || 1,\n    scrollView: null,\n    sortedKeys: [],\n\n    // Memoized\n    attrsMaxPreloadSlots: attrs.maxPreloadPages || Number.MAX_VALUE,\n    attrsPreloadSlots: attrs.preloadPages || 1,\n    autoSize,\n    axis,\n    classList,\n    contentTag,\n    pageSize,\n    scroll,\n    whichScroll,\n  };\n};\n\nconst view = ({ state, attrs }) => {\n  const scrollAmount = state.scrollView ? state.scrollView[state.whichScroll] : 0;\n  const axis = state.axis;\n  const maxPages = attrs.maxPages !== undefined ? attrs.maxPages : Number.MAX_VALUE;\n  \n  const currentPageNum = attrs.currentPage\n    ? parseInt(attrs.currentPage, 10)\n    : calculateCurrentPageNum(scrollAmount, state);\n\n  if (attrs.pageChange && currentPageNum !== state.currentPageNum) {\n    attrs.pageChange(currentPageNum);\n  }\n  state.currentPageNum = currentPageNum;\n\n  if (state.scrollView && attrs.getDimensions) {\n    attrs.getDimensions({\n      scrolled: scrollAmount,\n      size: state.contentSize\n    });\n  }\n\n  const { pages, prePages, maxPageNum } = getPageList(currentPageNum, attrs.from, attrs.to, attrs.currentPage, state.preloadSlots, maxPages);\n  state.contentSize = attrs.contentSize !== undefined\n    ? attrs.contentSize\n    : calculateContentSize(1, maxPageNum, state);\n\n  state.pageCount = pages.length;\n\n  const isLastPageVisible = maxPageNum\n    ? isPageInViewport(maxPageNum, axis, state, state.scrollView)\n    : true;\n  \n  return m(\"div\",\n    {\n      oncreate: ({ dom }) => {\n        state.scrollView = attrs.scrollView\n          ? document.querySelector(attrs.scrollView)\n          : dom;\n        state.scrollView.className += \" \" + state.classList;\n\n        if (attrs.setDimensions) {\n          const dimensions = attrs.setDimensions();\n          if (dimensions.size > 0) {\n            const whichSize = axis === \"x\"\n              ? \"width\"\n              : \"height\";\n            dom.style[whichSize] = dimensions.size + \"px\";\n          }\n          state.scrollView[state.whichScroll] = dimensions.scrolled;\n        }\n        state.scrollView.addEventListener(\"scroll\", state.scroll);\n      },\n      onremove: () => state.scrollView.removeEventListener(\"scroll\", state.scroll)\n    },\n    m(\"div\",\n      {\n        class: classes.scrollContent,\n        style: !state.autoSize\n          ? null\n          : Object.assign(\n            {},\n            axis === \"x\"\n              ? { width: state.contentSize + \"px\" }\n              : { height: state.contentSize + \"px\" },\n            attrs.contentSize\n              ? axis === \"x\"\n                ? { \"min-width\": attrs.contentSize + \"px\" }\n                : { \"min-height\": attrs.contentSize + \"px\" }\n              : {}\n          )\n      },\n      [\n        m(state.contentTag, { class: classes.content }, [\n          attrs.before\n            ? m(\"div\", {\n              class: classes.before,\n              oncreate: ({ dom }) => updatePart(dom, \"before\", state, axis),\n              onupdate: ({ dom }) => updatePart(dom, \"before\", state, axis)\n            }, attrs.before)\n            : null,\n          m(\"div\", { class: classes.pages }, [\n            prePages.map(pageNum => \n              m(placeholder, {\n                axis,\n                key: (attrs.pageKey || numToId)(pageNum),\n                pageId: numToId(pageNum),\n                pageNum,\n                pageSizes: state.pageSizes\n              })\n            ),\n            pages.map(pageNum =>\n              m(page, {\n                autoSize: state.autoSize,\n                axis,\n                item: attrs.item,\n                key: (attrs.pageKey || numToId)(pageNum),\n                pageData: attrs.pageData,\n                pageId: numToId(pageNum),\n                pageNum,\n                pageSize: state.pageSize,\n                pageSizes: state.pageSizes,\n                pageTag: attrs.pageTag,\n                pageUrl: attrs.pageUrl,\n                updatePageSize: updatePageSize(state)\n              })\n            )\n          ]),\n          // only show \"after\" when content is available\n          attrs.after && state.contentSize\n            ? m(\"div\", {\n              class: classes.after,\n              style: {\n                // visually hide this element until the last page is into view\n                // to prevent flashes of after content when scrolling fast\n                visibility: isLastPageVisible ? \"visible\" : \"hidden\"\n              },\n              oncreate: ({ dom }) => updatePart(dom, \"after\", state, axis),\n              onupdate: ({ dom }) => updatePart(dom, \"after\", state, axis),\n            }, attrs.after)\n            : null\n        ])\n      ]\n    )\n  );\n};\n\nexport const infinite = {\n  oninit,\n  view,\n  isElementInViewport\n};\n\n"],"names":["classes","root","make","this","xports","win","window","doc","document","docElem","documentElement","matchMedia","mq","q","call","matches","viewportW","a","b","viewportH","viewport","width","height","rectangle","el","cushion","nodeType","coords","o","calibrate","getBoundingClientRect","apply","arguments","pageXOffset","scrollLeft","pageYOffset","scrollTop","h","w","r","right","left","bottom","top","module","getElementSize","axis","styles","getComputedStyle","margin","parseFloat","marginLeft","marginRight","scrollWidth","marginTop","marginBottom","scrollHeight","isElementInViewport","leeway","verge","inY","inX","inViewport","makeClassName","page","pageNum","pageEven","pageOdd","join","guid","HALT","createStream","stream","length","updateStream","_state","value","constructor","id","undefined","state","derive","recover","deps","parents","endStream","unregister","map","ap","valueOf","toJSON","toString","defineProperties","get","changed","updateState","updateDependency","mustSync","every","active","some","combine","fn","streams","valid","Error","dep","filter","notEnded","registerDependency","i","initDependency","concat","unregisterStream","dependent","index","indexOf","splice","s1","s2","merge","s","scan","reducer","seed","newStream","scanMerge","tuples","tuple","forEach","idx","MapShim","Map","getIndex","arr","key","result","entry","anonymous","__entries__","prototypeAccessors","size","configurable","prototype","set","push","delete","entries","has","clear","callback","ctx","list","isBrowser","global$1","global","Math","self","Function","requestAnimationFrame$1","requestAnimationFrame","bind","setTimeout","Date","now","trailingTimeout","transitionKeys","mutationObserverSupported","MutationObserver","ResizeObserverController","connected_","mutationEventsAdded_","mutationsObserver_","observers_","onTransitionEnd_","refresh","delay","leadingCall","trailingCall","lastCallTime","resolvePending","timeoutCallback","proxy","timeStamp","throttle","addObserver","observer","connect_","removeObserver","observers","disconnect_","updateObservers_","activeObservers","gatherActive","hasActive","broadcastActive","addEventListener","observe","removeEventListener","disconnect","ref","propertyName","getInstance","instance_","defineConfigurable","target","props","Object","keys","defineProperty","getWindowOf","ownerDocument","defaultView","emptyRect","createRectInit","toFloat","getBordersSize","positions","len","reduce","position","getHTMLElementContentRect","clientWidth","clientHeight","paddings","getPaddings","horizPad","vertPad","boxSizing","round","isDocumentElement","vertScrollbar","horizScrollbar","abs","isSVGGraphicsElement","SVGGraphicsElement","SVGElement","getBBox","getContentRect","bbox","getSVGContentRect","x","y","ResizeObservation","broadcastWidth","broadcastHeight","contentRect_","isActive","rect","broadcastRect","ResizeObserverEntry","rectInit","Constr","contentRect","DOMRectReadOnly","create","ResizeObserverSPI","controller","callbackCtx","activeObservations_","observations_","TypeError","callback_","controller_","callbackCtx_","Element","observations","unobserve","clearActive","this$1","observation","WeakMap","ResizeObserver","method","attrs","content","pageData","resolve","then","m","redraw","pageUrl","request","processPageData","attrs1","data","item","className","pageTag","pageId","storedPageSize","pageSizes","pageSize","updatePageSize","cssSize","autoSize","update","dom","placeholder","vnode","_extends","emptyArray","emptyObject","type","ARRAY","OBJECT","STRING","FUNCTION","own","hasOwnProperty","freeze","defaults","source","k","cartesian","j","res","selectorTokenizer","splitSelector","selector","indices","inParen","exec","unshift","slice","ampersandTokenizer","ampersand","split","flatIter","f","iter","arg","decamelize","match","toLowerCase","declarations","emit","prefix","local","v","kk","test","replace","localizeReplacer","decl","atRules","nestingDepth","$atHandlers","err","JSON","stringify","adoptee","asString","localize","names","atrule","_atrule","rules","tree","inDeclaration","rule","closeSelectors","next","inline","lastSelector","init","raw","_rule","done","kind","param","takesBlock","kv","at","params","block","_at","j2c","buf","$sink","msg","_instance","endline","prop","$filters","floor","random","_createOrRetrieveStream","_walkers","options","_localizeReplacer","_localize","_use","plugin","$plugins","$filter","handler","$at","$names","_streams","_","name","suffix","ignore","global$$1","dot","removeStyle","old","getElementById","parentNode","removeChild","styleEl","createElement","setAttribute","styleList","style","scoped","@global","sheet","appendChild","createTextNode","head","addStyle","scrollView","scrollContent","scrollViewY","scrollViewX","numToId","substring","updatePart","whichSize","calculatePreloadSlots","boundingClientRect","preloadSlots","attrsPreloadSlots","contentSize","pageCount","attrsMaxPreloadSlots","whichScroll","contentTag","classList","class","preloadPages","maxPreloadPages","Number","MAX_VALUE","scrollAmount","maxPages","currentPageNum","currentPage","parseInt","pageNumKeys","sortedKeys","acc","beforeSize","pageKey","calculateCurrentPageNum","pageChange","getDimensions","fromPage","toPage","minPageNum","maxPageNum","pages","prePages","getPageList","from","to","fromIndex","max","toIndex","total","afterSize","calculateContentSize","isLastPageVisible","querySelector","isPageInViewport","setDimensions","dimensions","scrolled","scroll","min-width","min-height","before","oldSize","newSize","sort","after"],"mappings":"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"}