!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril"),require("verge"),require("resize-observer-polyfill"),require("j2c")):"function"==typeof define&&define.amd?define(["mithril","verge","resize-observer-polyfill","j2c"],t):e["mithril-infinite"]=t(e.m,e.verge,e["resize-observer-polyfill"],e.j2c)}(this,function(e,t,n,r){"use strict";function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e="default"in e?e.default:e,t="default"in t?t.default:t,n="default"in n?n.default:n,r="default"in r?r.default:r;var i,o={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",placeholder:"mithril-infinite__page--placeholder",before:"mithril-infinite__before",after:"mithril-infinite__after"},s=function(e,t){var n=window.getComputedStyle(e);if("x"===t){var r=parseFloat(n.marginLeft)+parseFloat(n.marginRight);return e.scrollWidth+r}var a=parseFloat(n.marginTop)+parseFloat(n.marginBottom);return e.scrollHeight+a},l=function(e){var n=e.el,r=e.axis,a=void 0===r?"y":r,i=e.leeway,o=void 0===i?300:i;return"y"===a?t.inY(n,o)||t.inY(n,-o):"x"===a?t.inX(n,o)||t.inX(n,-o):t.inViewport(n,o)||t.inViewport(n,-o)},c=function(e){return[o.page,e%2==0?o.pageEven:o.pageOdd].join(" ")},u=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){!function(){function t(){function e(){return arguments.length>0&&arguments[0]!==z&&r(e,arguments[0]),e._state.value}return n(e),arguments.length>0&&arguments[0]!==z&&r(e,arguments[0]),e}function n(e){e.constructor=t,e._state={id:y++,value:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],endStream:void 0,unregister:void 0},e.map=e["fantasy-land/map"]=f,e["fantasy-land/ap"]=d,e["fantasy-land/of"]=t,e.valueOf=p,e.toJSON=g,e.toString=p,Object.defineProperties(e,{end:{get:function(){if(!e._state.endStream){var n=t();n.map(function(t){return!0===t&&(u(e),n._state.unregister=function(){u(n)}),t}),e._state.endStream=n}return e._state.endStream}}})}function r(e,t){a(e,t);for(var n in e._state.deps)i(e._state.deps[n],!1);null!=e._state.unregister&&e._state.unregister(),o(e)}function a(e,t){e._state.value=t,e._state.changed=!0,2!==e._state.state&&(e._state.state=1)}function i(e,t){var n=e._state,r=n.parents;if(r.length>0&&r.every(h)&&(t||r.some(m))){var i=e._state.derive();if(i===z)return!1;a(e,i)}}function o(e){e._state.changed=!1;for(var t in e._state.deps)e._state.deps[t]._state.changed=!1}function s(e,n){if(!n.every(v))throw new Error("Ensure that each item passed to stream.combine/stream.merge is a stream");return l(t(),n,function(){return e.apply(this,n.concat([n.filter(m)]))})}function l(e,t,n){var r=e._state;return r.derive=n,r.parents=t.filter(S),c(e,r.parents),i(e,!0),e}function c(e,t){for(var n=0;n<t.length;n++)t[n]._state.deps[e._state.id]=e,c(e,t[n]._state.parents)}function u(e){for(var t=0;t<e._state.parents.length;t++){delete e._state.parents[t]._state.deps[e._state.id]}for(var n in e._state.deps){var r=e._state.deps[n],a=r._state.parents.indexOf(e);a>-1&&r._state.parents.splice(a,1)}e._state.state=2,e._state.deps={}}function f(e){return s(function(t){return e(t())},[this])}function d(e){return s(function(e,t){return e()(t())},[e,this])}function p(){return this._state.value}function g(){return null!=this._state.value&&"function"==typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function v(e){return e._state}function h(e){return 1===e._state.state}function m(e){return e._state.changed}function S(e){return 2!==e._state.state}function _(e){return s(function(){return e.map(function(e){return e()})},e)}function w(e,t,n){var r=s(function(n){return t=e(t,n._state.value)},[n]);return 0===r._state.state&&r(t),r}function x(e,t){var n=e.map(function(e){var t=e[0];return 0===t._state.state&&t(void 0),t});return s(function(){var r=arguments[arguments.length-1];return n.forEach(function(n,a){r.indexOf(n)>-1&&(t=e[a][1](t,n._state.value))}),t},n)}var y=0,z={};t["fantasy-land/of"]=t,t.merge=_,t.combine=s,t.scan=w,t.scanMerge=x,t.HALT=z,e.exports=t}()}),f=u,d=function(t){return e.request({method:"GET",url:t})},p=function(t){var n=t.state,r=t.attrs,a=r.pageNum,i=f([]);if(r.pageData){var o=r.pageData(a);Promise.resolve(o).then(i).then(e.redraw)}else if(r.pageUrl){var s=r.pageUrl(a);d(s).then(i)}var l=r.processPageData||function(e,t){return e&&e.length?e.map(function(e,n){return r.item(e,t,n)}):null};n.content=i,n.className=c(a),n.pageTag=r.pageTag||"div",n.processPageData=l},g=function(t){var r=t.state,a=t.attrs,i=a.pageId,o=a.pageSizes[i]||0,l=0;a.pageSize&&(l=a.pageSize(r.content()),a.updatePageSize(i,l));var c=l?l+"px":!a.autoSize||a.isScrolling&&o?o+"px":"auto",u=function(e){if(!l){var t=s(e,a.axis);t&&a.updatePageSize(i,t)}};return e(r.pageTag,{"data-page":i,class:r.className,style:o?"x"===a.axis?{width:c}:{height:c}:null,oncreate:function(e){var t=e.dom;new n(function(e){var n=!0,r=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value,f=c.contentRect,d=f.width,p=f.height;("x"===a.axis&&d!==o||"y"===a.axis&&p!==o)&&u(t)}}catch(e){r=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw i}}}).observe(t)},onupdate:function(e){var t=e.dom;return u(t)}},r.processPageData(r.content(),{isScrolling:a.isScrolling,pageId:a.pageId,pageNum:a.pageNum}))},v={oninit:p,view:g},h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m={oninit:function(e){return e.state.className=c(e.attrs.pageNum)},view:function(t){var n=t.state,r=t.attrs,a=r.pageId,i=r.pageSizes[a]||0;return e("div",{"data-page":a,class:[o.placeholder,n.className].join(" "),style:h({},"x"===r.axis?{width:i+"px"}:{height:i+"px"})})}},S=new r,_=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}},w=[a({},"."+o.scrollView,(i={"-webkit-overflow-scrolling":"touch",height:"100%"},a(i,"&."+o.scrollViewY,a({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+o.scrollContent,{height:"100%"})),a(i,"&."+o.scrollViewX,a({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+o.scrollContent,{width:"100%"})),i))];!function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];_(e);var a=document.createElement("style");e&&a.setAttribute("id",e),n.forEach(function(e){Object.keys(e).length&&e.forEach(function(e){var t={"@global":e},n=S.sheet(t);a.appendChild(document.createTextNode(n))})}),document.head.appendChild(a)}("mithril-infinite",w);var x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y="000000",z=function(e){return y.substring(0,y.length-(""+e).length)+e},b=function(e,t){var n=t.sortedKeys;if(0===n.length)return 1;for(var r=t.beforeSize||0,a=1,i=0;i<n.length;i+=1){var o=n[i];e>r&&(a=parseInt(o,10)),r+=t.pageSizes[o]}return a},P=function(e,t,n){var r=Math.max(0,e-1);if(t<r)return 0;var a=t,i=n.sortedKeys.slice(r,a),o=n.beforeSize||0;return o=i.reduce(function(e,t){return e+=n.pageSizes[t]||0},o),o+=n.afterSize||0},V=function(e,t,n,r){if(!r)return!1;var a=z(e),i=r.querySelector('[data-page="'+a+'"]');return l({el:i,axis:t})},N=function(e){return function(t,n){return e.pageSizes[t]=parseInt(n,10),e.sortedKeys=Object.keys(e.pageSizes).sort(),O(e)}},C=function(e,t,n,r){var a=s(e,r);a&&(n[t]=a)},O=function(t){if(t.scrollView){var n=t.scrollView.getBoundingClientRect();t.boundingClientRect=t.boundingClientRect||n,n.width===t.boundingClientRect.width&&n.height===t.boundingClientRect.height||(t.preloadSlots=t.attrsPreloadSlots||1),t.boundingClientRect=n,t.contentSize&&t.preloadSlots<t.pageCount&&t.preloadSlots<=t.attrsMaxPreloadSlots&&t.contentSize<n.height&&(t.preloadSlots++,setTimeout(e.redraw,0))}},T=function(e,t,n,r,a,i){for(var o=t?parseInt(t,10):r||1,s=n?parseInt(n,10):r||i,l=[],c=[],u=-a;u<=a;u+=1){var f=e+u;f>=o&&f<=s&&l.push(f)}for(var d=1;d<l[0];d+=1)c.push(d);return{pages:l,prePages:c,maxPageNum:s}};return{oninit:function(t){var n=t.attrs,r=n.axis||"y",a="x"===r?"scrollLeft":"scrollTop",i=void 0===n.autoSize||!1!==n.autoSize,s=n.pageSize,l=void 0!==n.throttle?1e3*n.throttle:200,c=n.contentTag||"div",u=[o.scrollView,"x"===r?o.scrollViewX:o.scrollViewY,n.class].join(" "),f=function(){var n=t.state;n.isScrolling=!0,n.scrollWatchUpdateStateId||(n.scrollWatchUpdateStateId=setTimeout(function(){e.redraw(),n.scrollWatchUpdateStateId=null,n.isScrolling=!1,setTimeout(function(){!1===n.isScrolling&&e.redraw()},60)},n.scrollThrottle))};t.state={afterSize:null,beforeSize:null,boundingClientRect:{},currentPageNum:0,isScrolling:!1,pageSizes:{},preloadSlots:n.preloadPages||1,scrollView:null,scrollWatchUpdateStateId:null,sortedKeys:[],attrsMaxPreloadSlots:n.maxPreloadPages||Number.MAX_VALUE,attrsPreloadSlots:n.preloadPages||1,autoSize:i,axis:r,classList:u,contentTag:c,pageSize:s,scroll:f,scrollThrottle:l,whichScroll:a}},view:function(t){var n=t.state,r=t.attrs,a=n.scrollView?n.scrollView[n.whichScroll]:0,i=n.axis,s=void 0!==r.maxPages?r.maxPages:Number.MAX_VALUE,l=r.currentPage?parseInt(r.currentPage,10):b(a,n);r.pageChange&&l!==n.currentPageNum&&r.pageChange(l),n.currentPageNum=l,n.scrollView&&r.getDimensions&&r.getDimensions({scrolled:a,size:n.contentSize});var c=T(l,r.from,r.to,r.currentPage,n.preloadSlots,s),u=c.pages,f=c.prePages,d=c.maxPageNum;n.contentSize=P(1,d,n),n.pageCount=u.length;var p=!d||V(d,i,0,n.scrollView);return e("div",{oncreate:function(e){var t=e.dom;if(n.scrollView=r.scrollView?document.querySelector(r.scrollView):t,n.scrollView.className+=" "+n.classList,r.setDimensions){var a=r.setDimensions();if(a.size>0){var o="x"===i?"width":"height";t.style[o]=a.size+"px"}n.scrollView[n.whichScroll]=a.scrolled}n.scrollView.addEventListener("scroll",n.scroll)},onremove:function(){return n.scrollView.removeEventListener("scroll",n.scroll)}},e("div",{class:o.scrollContent,style:n.autoSize?x({},"x"===i?{width:n.contentSize+"px"}:{height:n.contentSize+"px"},r.contentSize?"x"===i?{"min-width":r.contentSize+"px"}:{"min-height":r.contentSize+"px"}:{}):null},[e(n.contentTag,{class:o.content},[r.before?e("div",{class:o.before,oncreate:function(e){var t=e.dom;return C(t,"before",n,i)},onupdate:function(e){var t=e.dom;return C(t,"before",n,i)}},r.before):null,e("div",{class:o.pages},[f.map(function(t){return e(m,{axis:i,key:z(t),pageId:z(t),pageNum:t,pageSizes:n.pageSizes})}),u.map(function(t){return e(v,{autoSize:n.autoSize,axis:i,isScrolling:n.isScrolling,item:r.item,key:z(t),pageData:r.pageData,pageId:z(t),pageNum:t,pageSize:n.pageSize,pageSizes:n.pageSizes,pageTag:r.pageTag,pageUrl:r.pageUrl,updatePageSize:N(n)})})]),r.after&&n.contentSize?e("div",{class:o.after,style:{visibility:p?"visible":"hidden"},oncreate:function(e){var t=e.dom;return C(t,"after",n,i)},onupdate:function(e){var t=e.dom;return C(t,"after",n,i)}},r.after):null])]))},isElementInViewport:l}});
//# sourceMappingURL=mithril-infinite.js.map
