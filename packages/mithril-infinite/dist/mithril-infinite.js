!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril")):"function"==typeof define&&define.amd?define(["mithril"],t):e["mithril-infinite"]=t(e.m)}(this,function(e){"use strict";function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e,t){for(var n in t)X.call(t,n)&&(!n.indexOf("$")||n in e||(e[n]=t[n]));return e}function r(e,t){var n,r,i=[];for(r in t)if(X.call(t,r))for(n in e)X.call(e,n)&&i.push(e[n]+t[r]);return i}function i(e){for(var t,n=[],r=[],i=0;t=L.exec(e);)switch(t[0]){case"(":i++;break;case")":i--;break;case",":if(i)break;n.push(t.index)}for(t=n.length;t--;)r.unshift(e.slice(n[t]+1)),e=e.slice(0,n[t]);return r.unshift(e),r}function a(e,t){for(var n,i,a=[],o=[];i=U.exec(e);)"&"==i[0]&&a.push(i.index);for(i=a.length;i--;)o.unshift(e.slice(a[i]+1)),e=e.slice(0,a[i]);for(o.unshift(e),1===o.length&&o.unshift(""),n=[o[0]],i=1;i<o.length;i++)n=r(n,r(t,[o[i]]));return n.join(",")}function o(e){return function t(n){if(R.call(n)===k)for(var r=0;r<n.length;r++)t(n[r]);else e(n)}}function l(e){return"-"+e.toLowerCase()}function s(e,t,n,r,i){var a,o,c;if(null!=r)switch(R.call(r=r.valueOf())){case k:for(a=0;a<r.length;a++)s(e,t,n,r[a],i);break;case E:n=n&&n+"-";for(a in r)if(X.call(r,a))if(o=r[a],/\$/.test(a))for(c in a=a.split("$"))X.call(a,c)&&s(e,t,n+a[c],o,i);else s(e,t,n+a,o,i);break;default:a=n.replace(/_/g,"-").replace(/[A-Z]/g,l),!i||"animation-name"!=a&&"animation"!=a&&"list-style"!=a||(r=r.split(",").map(function(t){return t.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),t.decl(a,r)}}function c(e,t,n,r,i,a,l){for(var c=0;c<e.$atHandlers.length;c++)if(e.$atHandlers[c](e,t,n,r,i,a,l))return;if(!n[3]&&/^global$/.test(n[2]))u(e,t,i,r,0,l);else if(!n[3]&&/^local$/.test(n[2]))u(e,t,i,r,1,l);else if(n[3]&&/^adopt$/.test(n[2])){if(!a||l)return t.err("@adopt global or nested: "+n[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(n[3]))return t.err("bad adopter "+JSON.stringify(n[3])+" in "+n[0]);c=[],o(function(e,r){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(r=e+"")?c.push(r.replace(/\./g,"")):t.err("bad adoptee "+JSON.stringify(e)+" in "+n[0])})(r),c.length&&(e.localize(n[3]=n[3].replace(/\./g,"")),e.names[n[3]]+=" "+c.join(" "))}else!n[3]&&/^(?:namespace|import|charset)$/.test(n[2])?o(function(e){t.atrule(n[1],n[2],e)})(r):!n[3]&&/^(?:font-face|viewport)$/.test(n[2])?o(function(r){t.atrule(n[1],n[2],n[3],1),s(e,t,"",r,a),t._atrule()})(r):n[3]&&/^(?:media|supports|page|keyframes)$/.test(n[2])?(a&&"keyframes"==n[2]&&(n[3]=n[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,e.localizeReplacer)),t.atrule(n[1],n[2],n[3],1),"page"==n[2]?s(e,t,"",r,a):u(e,t,"keyframes"==n[2]?"":i,r,a,l+1),t._atrule()):t.err("Unsupported at-rule: "+n[0])}function u(e,t,n,r,o,l){var f,p,d,g;switch(R.call(r)){case E:for(f in r)if(X.call(r,f))if(p=r[f],n.length>0&&/^[-\w$]+$/.test(f))if(d||(d=1,t.rule(n)),/\$/.test(f))for(g in f=f.split("$"))X.call(f,g)&&s(e,t,f[g],p,o);else s(e,t,f,p,o);else/^@/.test(f)?(d=0,c(e,t,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*(.*?)\s*$/.exec(f)||[f,"@","",""],p,n,o,l)):(d=0,u(e,t,n.length>0&&(/,/.test(n)||/,/.test(f))?(g=i(n),i(o?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f).map(function(e){return/&/.test(e)?a(e,g):g.map(function(t){return t+e}).join(",")}).join(",")):/&/.test(f)?a(o?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f,[n]):n+(o?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f),p,o,l+1));break;case k:for(f=0;f<r.length;f++)u(e,t,n,r[f],o,l);break;case M:n.length||t.err("No selector"),t.rule(n||" "),s(e,t,"",r,o)}}function f(e,t){var n;return t?e:{init:function(){n=0,e.init()},done:function(t){return n&&(e._rule(),n=0),e.done(t)},atrule:function(t,r,i,a){n&&(e._rule(),n=0),e.atrule(t,r,i,a)},_atrule:function(t){n&&(e._rule(),n=0),e._atrule(t)},rule:function(t){t!==n&&(n&&e._rule(),e.rule(t),n=t)}}}function p(e){return":global("+e+")"}function d(e,t,n){return n={},n[e]=t,n}function g(e,t,n){if(arguments.length<3){var r=g.bind.apply(g,[null].concat([].slice.call(arguments,0)));return r.toString=function(){return"@"+e+" "+t},r}return d("@"+e+" "+t,n)}function h(){function e(e){if(!_.length){h.push(function(e,t){return t?{init:l.init,decl:l.decl,done:l.done,err:l.err}:l});for(var t=0;t<2;t++)for(var r=h.length;r--;)_[t]=D(n(h[r](_[t],!!t),_[t]))}return _[e]}function t(e){return v.names[e]||(v.names[e]=e+v.suffix),v.names[e].match(/^\S+/)}function r(e,n,r,i,a){return n||r||i+t(a)}var i,a,l={init:function(){i=[],a=[]},done:function(e){if(0!=a.length)throw new Error("j2c error(s): "+JSON.stringify(a,null,2)+"in context:\n"+i.join(""));return e?i:i.join("")},err:function(e){a.push(e),i.push("/* +++ ERROR +++ "+e+" */\n")},atrule:function(e,t,n,r){i.push(e,n&&" ",n,r?" {":";",v.endline)},_atrule:function(){i.push("}",v.endline)},rule:function(e){i.push(e," {",v.endline)},_rule:function(){i.push("}",v.endline)},decl:function(e,t){i.push(e,e&&":",t,";",v.endline)}},h=[f],m=[],v={at:g,global:p,kv:d,names:{},endline:"\n",suffix:"__j2c-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36)+"-"+Math.floor(4294967296*Math.random()).toString(36),$plugins:[],sheet:function(t){var n=e(0);return n.init(),u(w[0],n,"",t,1,0),n.done()},inline:function(t,n){var r=e(1);return r.init(),s(w[1],r,"",t,!(n&&n.global)),r.done()}},w=[{localizeReplacer:r,localize:t,names:v.names,$atHandlers:m,atrule:c,decl:s,rule:u},{localizeReplacer:r,localize:t,names:v.names,decl:s}],S=o(function(e){~v.$plugins.indexOf(e)||(v.$plugins.push(e),R.call(e)===Z&&(e=e(v)),e&&(o(function(e){h.push(e)})(e.$filter||C),o(function(e){m.push(e)})(e.$at||C),n(v.names,e.$names||I),S(e.$plugins||C),l=e.$sink||l,n(v,e)))}),_=[];return S(C.slice.call(arguments)),v}e="default"in e?e.default:e;var m,v={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",placeholder:"mithril-infinite__page--placeholder",before:"mithril-infinite__before",after:"mithril-infinite__after"},w="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=t(function(e){!function(t,n,r){e.exports?e.exports=r():t[n]=r()}(w,"verge",function(){function e(){return{width:u(),height:f()}}function t(e,t){var n={};return t=+t||0,n.width=(n.right=e.right+t)-(n.left=e.left-t),n.height=(n.bottom=e.bottom+t)-(n.top=e.top-t),n}function n(e,n){return e=e&&!e.nodeType?e[0]:e,!(!e||1!==e.nodeType)&&t(e.getBoundingClientRect(),n)}function r(t){t=null==t?e():1===t.nodeType?n(t):t;var r=t.height,i=t.width;return r="function"==typeof r?r.call(t):r,i="function"==typeof i?i.call(t):i,i/r}var i={},a="undefined"!=typeof window&&window,o="undefined"!=typeof document&&document,l=o&&o.documentElement,s=a.matchMedia||a.msMatchMedia,c=s?function(e){return!!s.call(a,e).matches}:function(){return!1},u=i.viewportW=function(){var e=l.clientWidth,t=a.innerWidth;return e<t?t:e},f=i.viewportH=function(){var e=l.clientHeight,t=a.innerHeight;return e<t?t:e};return i.mq=c,i.matchMedia=s?function(){return s.apply(a,arguments)}:function(){return{}},i.viewport=e,i.scrollX=function(){return a.pageXOffset||l.scrollLeft},i.scrollY=function(){return a.pageYOffset||l.scrollTop},i.rectangle=n,i.aspect=r,i.inX=function(e,t){var r=n(e,t);return!!r&&r.right>=0&&r.left<=u()},i.inY=function(e,t){var r=n(e,t);return!!r&&r.bottom>=0&&r.top<=f()},i.inViewport=function(e,t){var r=n(e,t);return!!r&&r.bottom>=0&&r.right>=0&&r.top<=f()&&r.left<=u()},i})}),_=300,z=function(e,t){var n=window.getComputedStyle(e);if("x"===t){var r=parseFloat(n.marginLeft)+parseFloat(n.marginRight);return e.scrollWidth+r}var i=parseFloat(n.marginTop)+parseFloat(n.marginBottom);return e.scrollHeight+i},b=function(e){var t=e.el,n=e.axis,r=void 0===n?"y":n,i=e.leeway,a=void 0===i?_:i;return"y"===r?S.inY(t,a)||S.inY(t,-a):"x"===r?S.inX(t,a)||S.inX(t,-a):S.inViewport(t,a)||S.inViewport(t,-a)},y=function(e){return[v.page,e%2===0?v.pageEven:v.pageOdd].join(" ")},x=t(function(e){function t(){function e(){return arguments.length>0&&arguments[0]!==z&&r(e,arguments[0]),e._state.value}return n(e),arguments.length>0&&arguments[0]!==z&&r(e,arguments[0]),e}function n(e){e.constructor=t,e._state={id:_++,value:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],endStream:void 0},e.map=e["fantasy-land/map"]=f,e["fantasy-land/ap"]=p,e["fantasy-land/of"]=t,e.valueOf=d,e.toJSON=g,e.toString=d,Object.defineProperties(e,{end:{get:function(){if(!e._state.endStream){var n=t();n.map(function(t){return t===!0&&(u(e),u(n)),t}),e._state.endStream=n}return e._state.endStream}}})}function r(e,t){i(e,t);for(var n in e._state.deps)a(e._state.deps[n],!1);o(e)}function i(e,t){e._state.value=t,e._state.changed=!0,2!==e._state.state&&(e._state.state=1)}function a(e,t){var n=e._state,r=n.parents;if(r.length>0&&r.every(m)&&(t||r.some(v))){var a=e._state.derive();if(a===z)return!1;i(e,a)}}function o(e){e._state.changed=!1;for(var t in e._state.deps)e._state.deps[t]._state.changed=!1}function l(e,n){if(!n.every(h))throw new Error("Ensure that each item passed to m.prop.combine/m.prop.merge is a stream");return s(t(),n,function(){return e.apply(this,n.concat([n.filter(v)]))})}function s(e,t,n){var r=e._state;return r.derive=n,r.parents=t.filter(w),c(e,r.parents),a(e,!0),e}function c(e,t){for(var n=0;n<t.length;n++)t[n]._state.deps[e._state.id]=e,c(e,t[n]._state.parents)}function u(e){for(var t=0;t<e._state.parents.length;t++){var n=e._state.parents[t];delete n._state.deps[e._state.id]}for(var r in e._state.deps){var i=e._state.deps[r],a=i._state.parents.indexOf(e);a>-1&&i._state.parents.splice(a,1)}e._state.state=2,e._state.deps={}}function f(e){return l(function(t){return e(t())},[this])}function p(e){return l(function(e,t){return e()(t())},[e,this])}function d(){return this._state.value}function g(){return null!=this._state.value&&"function"==typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function h(e){return e._state}function m(e){return 1===e._state.state}function v(e){return e._state.changed}function w(e){return 2!==e._state.state}function S(e){return l(function(){return e.map(function(e){return e()})},e)}var _=0,z={};t["fantasy-land/of"]=t,t.merge=S,t.combine=l,t.HALT=z,e.exports=t}),V=x,N=function(t){return e.request({method:"GET",url:t})},$=function(e){var t=e.state,n=e.attrs,r=n.pageNum,i=V([]);if(n.pageData){var a=n.pageData(r);a.then?a.then(i):i=a}else if(n.pageUrl){var o=n.pageUrl(r);N(o).then(i)}var l=n.processPageData||function(e,t){return e&&e.length?e.map(function(e,r){return n.item(e,t,r)}):null};t.content=i,t.className=y(r),t.pageTag=n.pageTag||"div",t.processPageData=l},A=function(t){var n=t.state,r=t.attrs,i=r.pageId,a=r.pageSizes[i]||0,o=0;r.pageSize&&(o=r.pageSize(n.content()),r.updatePageSize(i,o));var l=o?o+"px":!r.autoSize||r.isScrolling&&a?a+"px":"auto",s=function(t){if(!o){var n=z(t,r.axis);n&&r.updatePageSize(i,n),a||setTimeout(e.redraw,0)}};return e(n.pageTag,{"data-page":i,class:n.className,style:a?"x"===r.axis?{width:l}:{height:l}:null,oncreate:function(e){var t=e.dom;return s(t)},onupdate:function(e){var t=e.dom;return s(t)}},n.processPageData(n.content(),{isScrolling:r.isScrolling,pageId:r.pageId,pageNum:r.pageNum}))},P={oninit:$,view:A},O=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},j={oninit:function(e){return e.state.className=y(e.attrs.pageNum)},view:function(t){var n=t.state,r=t.attrs,i=r.pageId,a=r.pageSizes[i]||0;return e("div",{"data-page":i,class:[v.placeholder,n.className].join(" "),style:T({},"x"===r.axis?{width:a+"px"}:{height:a+"px"})})}},C=[],I={},R=I.toString,k=R.call(C),E=R.call(I),M=R.call(""),Z=R.call(R),X=I.hasOwnProperty,D=Object.freeze||function(e){return e},L=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,U=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,W=h,Y=new W,H=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];J(e);var i=document.createElement("style");e&&i.setAttribute("id",e),n.forEach(function(e){Object.keys(e).length&&e.forEach(function(e){var t={"@global":e},n=Y.sheet(t);i.appendChild(document.createTextNode(n))})}),document.head.appendChild(i)},J=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}},q=[O({},"."+v.scrollView,(m={"-webkit-overflow-scrolling":"touch",height:"100%"},O(m,"&."+v.scrollViewY,O({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+v.scrollContent,{height:"100%"})),O(m,"&."+v.scrollViewX,O({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+v.scrollContent,{width:"100%"})),m))];H("mithril-infinite",q);var B=200,F="000000",K=function(e){return F.substring(0,F.length-(""+e).length)+e},G=function(e,t){var n=t.sortedKeys;if(0===n.length)return 1;for(var r=t.beforeSize||0,i=1,a=0;a<n.length;a+=1){var o=n[a];e>r&&(i=parseInt(o,10)),r+=t.pageSizes[o]}return i},Q=function(e,t,n){var r=Math.max(0,e-1);if(t<r)return 0;var i=t,a=n.sortedKeys.slice(r,i),o=n.beforeSize||0;return o=a.reduce(function(e,t){return e+=n.pageSizes[t]||0},o),o+=n.afterSize||0},ee=function(e,t,n,r){if(!r)return!1;var i=K(e),a=r.querySelector('[data-page="'+i+'"]');return b({el:a,axis:t})},te=function(e){return function(t,n){return e.pageSizes[t]=n,e.sortedKeys=Object.keys(e.pageSizes).sort()}},ne=function(t,n,r){var i=function(){t.isScrolling=!0,clearTimeout(t.scrollWatchScrollingStateId),t.scrollWatchScrollingStateId=setTimeout(function(){t.isScrolling=!1,e.redraw()},t.scrollThrottle),t.scrollWatchUpdateStateId||(t.scrollWatchUpdateStateId=setTimeout(function(){e.redraw(),t.scrollWatchUpdateStateId=null},t.scrollThrottle))};"add"===r?n.addEventListener("scroll",i):n.removeEventListener("scroll",i)},re=function(e,t,n,r){var i=z(e,r);i&&(n[t]=i)},ie=function(e,t,n,r,i,a){for(var o=t?parseInt(t,10):r?r:1,l=n?parseInt(n,10):r?r:a,s=[],c=[],u=-i;u<=i;u+=1){var f=e+u;f>=o&&f<=l&&s.push(f)}for(var p=1;p<s[0];p+=1)c.push(p);return{pages:s,prePages:c,maxPageNum:l}},ae=function(e){var t=e.attrs,n=t.axis||"y",r="x"===n?"scrollLeft":"scrollTop",i=void 0===t.autoSize||t.autoSize!==!1,a=t.pageSize,o=void 0!==t.throttle?1e3*t.throttle:B,l=t.contentTag||"div",s=[v.scrollView,"x"===n?v.scrollViewX:v.scrollViewY,t.class].join(" ");e.state=T({},{pageSizes:{},sortedKeys:[],beforeSize:null,afterSize:null,scrollView:null,isScrolling:!1,scrollWatchScrollingStateId:null,scrollWatchUpdateStateId:null,preloadSlots:t.preloadPages||1,boundingClientRect:{},currentPageNum:0,scrollAmount:0,classList:s,axis:n,whichScroll:r,autoSize:i,pageSize:a,scrollThrottle:o,contentTag:l})},oe=function(t){var n=t.state,r=t.attrs;n.scrollAmount=n.scrollView?n.scrollView[n.whichScroll]:0;var i=n.axis,a=void 0!==r.maxPages?r.maxPages:Number.MAX_VALUE,o=r.currentPage?parseInt(r.currentPage,10):G(n.scrollAmount,n);r.pageChange&&o!==n.currentPageNum&&r.pageChange(o),n.currentPageNum=o,n.scrollView&&r.getDimensions&&r.getDimensions({scrolled:n.scrollAmount,size:n.contentSize});var l=ie(o,r.from,r.to,r.currentPage,n.preloadSlots,a),s=l.pages,c=l.prePages,u=l.maxPageNum;n.contentSize=Q(1,u,n);var f=!u||ee(u,i,n,n.scrollView);if(n.scrollView){var p=n.scrollView.getBoundingClientRect();n.boundingClientRect=n.boundingClientRect||p,p.width===n.boundingClientRect.width&&p.height===n.boundingClientRect.height||(n.preloadSlots=r.preloadPages||1),n.boundingClientRect=p;var d=r.maxPreloadPages||Number.MAX_VALUE;n.contentSize&&n.preloadSlots<s.length&&n.preloadSlots<=d&&n.contentSize<p.height&&(n.preloadSlots++,setTimeout(e.redraw,0))}return e("div",{oncreate:function(e){var t=e.dom;if(n.scrollView=r.scrollView?document.querySelector(r.scrollView):t,n.scrollView.className+=" "+n.classList,r.setDimensions){var a=r.setDimensions();if(a.size>0){var o="x"===i?"width":"height";t.style[o]=a.size+"px"}n.scrollView[n.whichScroll]=a.scrolled}ne(n,n.scrollView,"add")},onremove:function(){return ne(n,n.scrollView,"remove")}},e("div",{class:v.scrollContent,style:n.autoSize?T({},"x"===i?{width:n.contentSize+"px"}:{height:n.contentSize+"px"},r.contentSize?"x"===i?{"min-width":r.contentSize+"px"}:{"min-height":r.contentSize+"px"}:{}):null},[e(n.contentTag,{class:v.content},[r.before?e("div",{class:v.before,oncreate:function(e){var t=e.dom;return re(t,"before",n,i)},onupdate:function(e){var t=e.dom;return re(t,"before",n,i)}},r.before):null,e("div",{class:v.pages},[c.map(function(t){return e(j,T({},{axis:i,key:K(t),pageId:K(t),pageNum:t,pageSizes:n.pageSizes}))}),s.map(function(t){return e(P,T({},{autoSize:n.autoSize,axis:i,isScrolling:n.isScrolling,item:r.item,key:K(t),pageData:r.pageData,pageId:K(t),pageNum:t,pageSize:n.pageSize,pageSizes:n.pageSizes,pageTag:r.pageTag,pageUrl:r.pageUrl,updatePageSize:te(n)}))})]),r.after&&n.contentSize?e("div",{class:v.after,style:{visibility:f?"visible":"hidden"},oncreate:function(e){var t=e.dom;return re(t,"after",n,i)},onupdate:function(e){var t=e.dom;return re(t,"after",n,i)}},r.after):null])]))},le={oninit:ae,view:oe,isElementInViewport:b};return le});
//# sourceMappingURL=mithril-infinite.js.map
