!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril"),require("verge"),require("mithril/stream"),require("resize-observer-polyfill"),require("j2c")):"function"==typeof define&&define.amd?define(["mithril","verge","mithril/stream","resize-observer-polyfill","j2c"],t):(e=e||self).polythene=t(e.m,e.verge,e.stream,e["resize-observer-polyfill"],e.j2c)}(this,function(e,t,r,i,n){"use strict";function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n;var l,s={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",placeholder:"mithril-infinite__page--placeholder",before:"mithril-infinite__before",after:"mithril-infinite__after"},c=function(e,t){var r=window.getComputedStyle(e);if("x"===t){var i=parseFloat(r.marginLeft)+parseFloat(r.marginRight);return e.scrollWidth+i}var n=parseFloat(r.marginTop)+parseFloat(r.marginBottom);return e.scrollHeight+n},u=function(e){var r=e.el,i=e.axis,n=void 0===i?"y":i,a=e.leeway,o=void 0===a?300:a;return"y"===n?t.inY(r,o)||t.inY(r,-o):"x"===n?t.inX(r,o)||t.inX(r,-o):t.inViewport(r,o)||t.inViewport(r,-o)},g=function(e){return[s.page,e%2==0?s.pageEven:s.pageOdd].join(" ")},p={oninit:function(t){var i=t.state,n=t.attrs,a=n.pageNum,o=r([]);if(n.pageData){var l=n.pageData(a);Promise.resolve(l).then(o).then(e.redraw)}else n.pageUrl&&function(t){return e.request({method:"GET",url:t})}(n.pageUrl(a)).then(o);var s=n.processPageData||function(e,t){return e&&e.length?e.map(function(e,r){return n.item(e,t,r)}):null};i.content=o,i.className=g(a),i.pageTag=n.pageTag||"div",i.processPageData=s},view:function(t){var r=t.state,n=t.attrs,a=n.pageId,o=n.pageSizes[a]||0,l=0;n.pageSize&&(l=n.pageSize(r.content()),n.updatePageSize(a,l));var s=l?l+"px":n.autoSize?"auto":o+"px",u=function(e){if(!l){var t=c(e,n.axis);t&&n.updatePageSize(a,t)}};return e(r.pageTag,{"data-page":a,class:r.className,style:o?"x"===n.axis?{width:s}:{height:s}:null,oncreate:function(e){var t=e.dom;new i(function(e){var r=!0,i=!1,a=void 0;try{for(var l,s=e[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value.contentRect,g=c.width,p=c.height;("x"===n.axis&&g!==o||"y"===n.axis&&p!==o)&&u(t)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}).observe(t)},onupdate:function(e){var t=e.dom;return u(t)}},r.processPageData(r.content(),{pageId:n.pageId,pageNum:n.pageNum}))}},d={oninit:function(e){return e.state.className=g(e.attrs.pageNum)},view:function(t){var r=t.state,i=t.attrs,n=i.pageId,a=i.pageSizes[n]||0;return e("div",{"data-page":n,class:[s.placeholder,r.className].join(" "),style:o({},"x"===i.axis?{width:a+"px"}:{height:a+"px"})})}},f=new n,h=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}};!function(e){h(e);var t=document.createElement("style");e&&t.setAttribute("id",e);for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];i.forEach(function(e){Object.keys(e).length&&e.forEach(function(e){var r={"@global":e},i=f.sheet(r);t.appendChild(document.createTextNode(i))})}),document.head.appendChild(t)}("mithril-infinite",[a({},"."+s.scrollView,(l={"-webkit-overflow-scrolling":"touch",height:"100%"},a(l," ."+s.scrollContent,{overflowAnchor:"none"}),a(l,"&."+s.scrollViewY,a({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+s.scrollContent,{height:"100%"})),a(l,"&."+s.scrollViewX,a({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+s.scrollContent,{width:"100%"})),l))]);var v=function(e){return"000000".substring(0,"000000".length-(""+e).length)+e},m=function(t){return function(r,i){var n=t.pageSizes[r],a=parseInt(i,10);n!==a&&(t.pageSizes[r]=a,t.sortedKeys=Object.keys(t.pageSizes).sort(),S(t),setTimeout(e.redraw,0))}},w=function(e,t,r,i){var n=c(e,i);n&&(r[t]=n)},S=function(t){if(t.scrollView){var r=t.scrollView.getBoundingClientRect();t.boundingClientRect=t.boundingClientRect||r,r.width===t.boundingClientRect.width&&r.height===t.boundingClientRect.height||(t.preloadSlots=t.attrsPreloadSlots||1),t.boundingClientRect=r,t.contentSize&&t.preloadSlots<t.pageCount&&t.preloadSlots<=t.attrsMaxPreloadSlots&&t.contentSize<r.height&&(t.preloadSlots++,setTimeout(e.redraw,0))}};return{oninit:function(t){var r=t.attrs,i=r.axis||"y",n="x"===i?"scrollLeft":"scrollTop",a=void 0===r.autoSize||!1!==r.autoSize,o=r.pageSize,l=r.contentTag||"div",c=[s.scrollView,"x"===i?s.scrollViewX:s.scrollViewY,r.class].join(" ");t.state={afterSize:null,beforeSize:null,boundingClientRect:{},currentPageNum:0,pageSizes:{},preloadSlots:r.preloadPages||1,scrollView:null,sortedKeys:[],attrsMaxPreloadSlots:r.maxPreloadPages||Number.MAX_VALUE,attrsPreloadSlots:r.preloadPages||1,autoSize:a,axis:i,classList:c,contentTag:l,pageSize:o,scroll:function(){return e.redraw()},whichScroll:n}},view:function(t){var r=t.state,i=t.attrs,n=r.scrollView?r.scrollView[r.whichScroll]:0,a=r.axis,l=void 0!==i.maxPages?i.maxPages:Number.MAX_VALUE,c=i.currentPage?parseInt(i.currentPage,10):function(e,t){var r=t.sortedKeys;if(0===r.length)return 1;for(var i=t.beforeSize||0,n=1,a=0;a<r.length;a+=1){var o=r[a];e>i&&(n=parseInt(o,10)),i+=t.pageSizes[o]}return n}(n,r);i.pageChange&&c!==r.currentPageNum&&i.pageChange(c),r.currentPageNum=c,r.scrollView&&i.getDimensions&&i.getDimensions({scrolled:n,size:r.contentSize});var g=function(e,t,r,i,n,a){for(var o=t?parseInt(t,10):i||1,l=r?parseInt(r,10):i||a,s=[],c=[],u=-n;u<=n;u+=1){var g=e+u;g>=o&&g<=l&&s.push(g)}for(var p=1;p<s[0];p+=1)c.push(p);return{pages:s,prePages:c,maxPageNum:l}}(c,i.from,i.to,i.currentPage,r.preloadSlots,l),f=g.pages,h=g.prePages,S=g.maxPageNum;r.contentSize=void 0!==i.contentSize?i.contentSize:function(e,t,r){var i=Math.max(0,e-1);if(t<i)return 0;var n=t,a=r.sortedKeys.slice(i,n),o=r.beforeSize||0;return o=a.reduce(function(e,t){return e+(r.pageSizes[t]||0)},o),o+=r.afterSize||0}(1,S,r),r.pageCount=f.length;var z=!S||function(e,t,r,i){if(!i)return!1;var n=v(e),a=i.querySelector('[data-page="'.concat(n,'"]'));return u({el:a,axis:t})}(S,a,0,r.scrollView);return e("div",{oncreate:function(e){var t=e.dom;if(r.scrollView=i.scrollView?document.querySelector(i.scrollView):t,r.scrollView.className+=" "+r.classList,i.setDimensions){var n=i.setDimensions();if(n.size>0){var o="x"===a?"width":"height";t.style[o]=n.size+"px"}r.scrollView[r.whichScroll]=n.scrolled}r.scrollView.addEventListener("scroll",r.scroll)},onremove:function(){return r.scrollView.removeEventListener("scroll",r.scroll)}},e("div",{class:s.scrollContent,style:r.autoSize?o({},"x"===a?{width:r.contentSize+"px"}:{height:r.contentSize+"px"},i.contentSize?"x"===a?{"min-width":i.contentSize+"px"}:{"min-height":i.contentSize+"px"}:{}):null},[e(r.contentTag,{class:s.content},[i.before?e("div",{class:s.before,oncreate:function(e){var t=e.dom;return w(t,"before",r,a)},onupdate:function(e){var t=e.dom;return w(t,"before",r,a)}},i.before):null,e("div",{class:s.pages},[h.map(function(t){return e(d,{axis:a,key:(i.pageKey||v)(t),pageId:v(t),pageNum:t,pageSizes:r.pageSizes})}),f.map(function(t){return e(p,{autoSize:r.autoSize,axis:a,item:i.item,key:(i.pageKey||v)(t),pageData:i.pageData,pageId:v(t),pageNum:t,pageSize:r.pageSize,pageSizes:r.pageSizes,pageTag:i.pageTag,pageUrl:i.pageUrl,updatePageSize:m(r)})})]),i.after&&r.contentSize?e("div",{class:s.after,style:{visibility:z?"visible":"hidden"},oncreate:function(e){var t=e.dom;return w(t,"after",r,a)},onupdate:function(e){var t=e.dom;return w(t,"after",r,a)}},i.after):null])]))},isElementInViewport:u}});
//# sourceMappingURL=mithril-infinite.js.map
