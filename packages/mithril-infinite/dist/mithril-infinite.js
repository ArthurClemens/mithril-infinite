!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril"),require("verge"),require("resize-observer-polyfill"),require("j2c")):"function"==typeof define&&define.amd?define(["mithril","verge","resize-observer-polyfill","j2c"],t):e["mithril-infinite"]=t(e.m,e.verge,e["resize-observer-polyfill"],e.j2c)}(this,function(e,t,n,r){"use strict";e="default"in e?e.default:e,t="default"in t?t.default:t,n="default"in n?n.default:n,r="default"in r?r.default:r;var i,a={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",placeholder:"mithril-infinite__page--placeholder",before:"mithril-infinite__before",after:"mithril-infinite__after"},o=function(e,t){var n=window.getComputedStyle(e);if("x"===t){var r=parseFloat(n.marginLeft)+parseFloat(n.marginRight);return e.scrollWidth+r}var i=parseFloat(n.marginTop)+parseFloat(n.marginBottom);return e.scrollHeight+i},s=function(e){var n=e.el,r=e.axis,i=void 0===r?"y":r,a=e.leeway,o=void 0===a?300:a;return"y"===i?t.inY(n,o)||t.inY(n,-o):"x"===i?t.inX(n,o)||t.inX(n,-o):t.inViewport(n,o)||t.inViewport(n,-o)},l=function(e){return[a.page,e%2==0?a.pageEven:a.pageOdd].join(" ")},u=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){!function(){function t(){function e(){return arguments.length>0&&arguments[0]!==z&&r(e,arguments[0]),e._state.value}return n(e),arguments.length>0&&arguments[0]!==z&&r(e,arguments[0]),e}function n(e){e.constructor=t,e._state={id:y++,value:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],endStream:void 0,unregister:void 0},e.map=e["fantasy-land/map"]=f,e["fantasy-land/ap"]=d,e["fantasy-land/of"]=t,e.valueOf=p,e.toJSON=g,e.toString=p,Object.defineProperties(e,{end:{get:function(){if(!e._state.endStream){var n=t();n.map(function(t){return!0===t&&(c(e),n._state.unregister=function(){c(n)}),t}),e._state.endStream=n}return e._state.endStream}}})}function r(e,t){i(e,t);for(var n in e._state.deps)a(e._state.deps[n],!1);null!=e._state.unregister&&e._state.unregister(),o(e)}function i(e,t){e._state.value=t,e._state.changed=!0,2!==e._state.state&&(e._state.state=1)}function a(e,t){var n=e._state,r=n.parents;if(r.length>0&&r.every(h)&&(t||r.some(m))){var a=e._state.derive();if(a===z)return!1;i(e,a)}}function o(e){e._state.changed=!1;for(var t in e._state.deps)e._state.deps[t]._state.changed=!1}function s(e,n){if(!n.every(v))throw new Error("Ensure that each item passed to stream.combine/stream.merge is a stream");return l(t(),n,function(){return e.apply(this,n.concat([n.filter(m)]))})}function l(e,t,n){var r=e._state;return r.derive=n,r.parents=t.filter(S),u(e,r.parents),a(e,!0),e}function u(e,t){for(var n=0;n<t.length;n++)t[n]._state.deps[e._state.id]=e,u(e,t[n]._state.parents)}function c(e){for(var t=0;t<e._state.parents.length;t++){delete e._state.parents[t]._state.deps[e._state.id]}for(var n in e._state.deps){var r=e._state.deps[n],i=r._state.parents.indexOf(e);i>-1&&r._state.parents.splice(i,1)}e._state.state=2,e._state.deps={}}function f(e){return s(function(t){return e(t())},[this])}function d(e){return s(function(e,t){return e()(t())},[e,this])}function p(){return this._state.value}function g(){return null!=this._state.value&&"function"==typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function v(e){return e._state}function h(e){return 1===e._state.state}function m(e){return e._state.changed}function S(e){return 2!==e._state.state}function _(e){return s(function(){return e.map(function(e){return e()})},e)}function w(e,t,n){var r=s(function(n){return t=e(t,n._state.value)},[n]);return 0===r._state.state&&r(t),r}function x(e,t){var n=e.map(function(e){var t=e[0];return 0===t._state.state&&t(void 0),t});return s(function(){var r=arguments[arguments.length-1];return n.forEach(function(n,i){r.indexOf(n)>-1&&(t=e[i][1](t,n._state.value))}),t},n)}var y=0,z={};t["fantasy-land/of"]=t,t.merge=_,t.combine=s,t.scan=w,t.scanMerge=x,t.HALT=z,e.exports=t}()}),c=u,f=function(t){return e.request({method:"GET",url:t})},d=function(e){var t=e.state,n=e.attrs,r=n.pageNum,i=c([]);if(n.pageData){var a=n.pageData(r);Promise.resolve(a).then(i)}else if(n.pageUrl){var o=n.pageUrl(r);f(o).then(i)}var s=n.processPageData||function(e,t){return e&&e.length?e.map(function(e,r){return n.item(e,t,r)}):null};t.content=i,t.className=l(r),t.pageTag=n.pageTag||"div",t.processPageData=s},p=function(t){var r=t.state,i=t.attrs,a=i.pageId,s=i.pageSizes[a]||0,l=0;i.pageSize&&(l=i.pageSize(r.content()),i.updatePageSize(a,l));var u=l?l+"px":!i.autoSize||i.isScrolling&&s?s+"px":"auto",c=function(e){if(!l){var t=o(e,i.axis);t&&i.updatePageSize(a,t)}};return e(r.pageTag,{"data-page":a,class:r.className,style:s?"x"===i.axis?{width:u}:{height:u}:null,oncreate:function(e){var t=e.dom;new n(function(e){var n=!0,r=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value,f=u.contentRect,d=f.width,p=f.height;("x"===i.axis&&d!==s||"y"===i.axis&&p!==s)&&c(t)}}catch(e){r=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw a}}}).observe(t)},onupdate:function(e){var t=e.dom;return c(t)}},r.processPageData(r.content(),{isScrolling:i.isScrolling,pageId:i.pageId,pageNum:i.pageNum}))},g={oninit:d,view:p},v=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m={oninit:function(e){return e.state.className=l(e.attrs.pageNum)},view:function(t){var n=t.state,r=t.attrs,i=r.pageId,o=r.pageSizes[i]||0;return e("div",{"data-page":i,class:[a.placeholder,n.className].join(" "),style:h({},"x"===r.axis?{width:o+"px"}:{height:o+"px"})})}},S=new r,_=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}},w=[v({},"."+a.scrollView,(i={"-webkit-overflow-scrolling":"touch",height:"100%"},v(i,"&."+a.scrollViewY,v({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+a.scrollContent,{height:"100%"})),v(i,"&."+a.scrollViewX,v({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+a.scrollContent,{width:"100%"})),i))];!function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];_(e);var i=document.createElement("style");e&&i.setAttribute("id",e),n.forEach(function(e){Object.keys(e).length&&e.forEach(function(e){var t={"@global":e},n=S.sheet(t);i.appendChild(document.createTextNode(n))})}),document.head.appendChild(i)}("mithril-infinite",w);var x="000000",y=function(e){return x.substring(0,x.length-(""+e).length)+e},z=function(e,t){var n=t.sortedKeys;if(0===n.length)return 1;for(var r=t.beforeSize||0,i=1,a=0;a<n.length;a+=1){var o=n[a];e>r&&(i=parseInt(o,10)),r+=t.pageSizes[o]}return i},b=function(e,t,n){var r=Math.max(0,e-1);if(t<r)return 0;var i=t,a=n.sortedKeys.slice(r,i),o=n.beforeSize||0;return o=a.reduce(function(e,t){return e+=n.pageSizes[t]||0},o),o+=n.afterSize||0},P=function(e,t,n,r){if(!r)return!1;var i=y(e),a=r.querySelector('[data-page="'+i+'"]');return s({el:a,axis:t})},V=function(e){return function(t,n){return e.pageSizes[t]=parseInt(n,10),e.sortedKeys=Object.keys(e.pageSizes).sort(),C(e)}},N=function(e,t,n,r){var i=o(e,r);i&&(n[t]=i)},C=function(t){if(t.scrollView){var n=t.scrollView.getBoundingClientRect();t.boundingClientRect=t.boundingClientRect||n,n.width===t.boundingClientRect.width&&n.height===t.boundingClientRect.height||(t.preloadSlots=t.attrsPreloadSlots||1),t.boundingClientRect=n,t.contentSize&&t.preloadSlots<t.pageCount&&t.preloadSlots<=t.attrsMaxPreloadSlots&&t.contentSize<n.height&&(t.preloadSlots++,setTimeout(e.redraw,0))}},T=function(e,t,n,r,i,a){for(var o=t?parseInt(t,10):r||1,s=n?parseInt(n,10):r||a,l=[],u=[],c=-i;c<=i;c+=1){var f=e+c;f>=o&&f<=s&&l.push(f)}for(var d=1;d<l[0];d+=1)u.push(d);return{pages:l,prePages:u,maxPageNum:s}};return{oninit:function(t){var n=t.attrs,r=n.axis||"y",i="x"===r?"scrollLeft":"scrollTop",o=void 0===n.autoSize||!1!==n.autoSize,s=n.pageSize,l=void 0!==n.throttle?1e3*n.throttle:200,u=n.contentTag||"div",c=[a.scrollView,"x"===r?a.scrollViewX:a.scrollViewY,n.class].join(" "),f=function(){var n=t.state;n.isScrolling=!0,n.scrollWatchUpdateStateId||(n.scrollWatchUpdateStateId=setTimeout(function(){e.redraw(),n.scrollWatchUpdateStateId=null,n.isScrolling=!1,setTimeout(function(){!1===n.isScrolling&&e.redraw()},60)},n.scrollThrottle))};t.state={afterSize:null,beforeSize:null,boundingClientRect:{},currentPageNum:0,isScrolling:!1,pageSizes:{},preloadSlots:n.preloadPages||1,scrollView:null,scrollWatchUpdateStateId:null,sortedKeys:[],attrsMaxPreloadSlots:n.maxPreloadPages||Number.MAX_VALUE,attrsPreloadSlots:n.preloadPages||1,autoSize:o,axis:r,classList:c,contentTag:u,pageSize:s,scroll:f,scrollThrottle:l,whichScroll:i}},view:function(t){var n=t.state,r=t.attrs,i=n.scrollView?n.scrollView[n.whichScroll]:0,o=n.axis,s=void 0!==r.maxPages?r.maxPages:Number.MAX_VALUE,l=r.currentPage?parseInt(r.currentPage,10):z(i,n);r.pageChange&&l!==n.currentPageNum&&r.pageChange(l),n.currentPageNum=l,n.scrollView&&r.getDimensions&&r.getDimensions({scrolled:i,size:n.contentSize});var u=T(l,r.from,r.to,r.currentPage,n.preloadSlots,s),c=u.pages,f=u.prePages,d=u.maxPageNum;n.contentSize=b(1,d,n),n.pageCount=c.length;var p=!d||P(d,o,0,n.scrollView);return e("div",{oncreate:function(e){var t=e.dom;if(n.scrollView=r.scrollView?document.querySelector(r.scrollView):t,n.scrollView.className+=" "+n.classList,r.setDimensions){var i=r.setDimensions();if(i.size>0){var a="x"===o?"width":"height";t.style[a]=i.size+"px"}n.scrollView[n.whichScroll]=i.scrolled}n.scrollView.addEventListener("scroll",n.scroll)},onremove:function(){return n.scrollView.removeEventListener("scroll",n.scroll)}},e("div",{class:a.scrollContent,style:n.autoSize?h({},"x"===o?{width:n.contentSize+"px"}:{height:n.contentSize+"px"},r.contentSize?"x"===o?{"min-width":r.contentSize+"px"}:{"min-height":r.contentSize+"px"}:{}):null},[e(n.contentTag,{class:a.content},[r.before?e("div",{class:a.before,oncreate:function(e){var t=e.dom;return N(t,"before",n,o)},onupdate:function(e){var t=e.dom;return N(t,"before",n,o)}},r.before):null,e("div",{class:a.pages},[f.map(function(t){return e(m,{axis:o,key:y(t),pageId:y(t),pageNum:t,pageSizes:n.pageSizes})}),c.map(function(t){return e(g,{autoSize:n.autoSize,axis:o,isScrolling:n.isScrolling,item:r.item,key:y(t),pageData:r.pageData,pageId:y(t),pageNum:t,pageSize:n.pageSize,pageSizes:n.pageSizes,pageTag:r.pageTag,pageUrl:r.pageUrl,updatePageSize:V(n)})})]),r.after&&n.contentSize?e("div",{class:a.after,style:{visibility:p?"visible":"hidden"},oncreate:function(e){var t=e.dom;return N(t,"after",n,o)},onupdate:function(e){var t=e.dom;return N(t,"after",n,o)}},r.after):null])]))},isElementInViewport:s}});
//# sourceMappingURL=mithril-infinite.js.map
