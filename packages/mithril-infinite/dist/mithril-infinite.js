!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril"),require("verge"),require("j2c")):"function"==typeof define&&define.amd?define(["mithril","verge","j2c"],t):e["mithril-infinite"]=t(e.m,e.verge,e.j2c)}(this,function(e,t,i){"use strict";function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}e="default"in e?e.default:e,t="default"in t?t.default:t,i="default"in i?i.default:i;var n={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",before:"mithril-infinite__before",after:"mithril-infinite__after"},o=function(e,t){var i=window.getComputedStyle(e);if("x"===t){var r=parseFloat(i.marginLeft)+parseFloat(i.marginRight);return e.scrollWidth+r}var n=parseFloat(i.marginTop)+parseFloat(i.marginBottom);return e.scrollHeight+n},l=function(e){var i=e.el,r=e.axis,n=void 0===r?"y":r,o=e.leeway,l=void 0===o?300:o;return"y"===n?t.inY(i,l)||t.inY(i,-l):"x"===n?t.inX(i,l)||t.inX(i,-l):t.inViewport(i,l)||t.inViewport(i,-l)},a=function(e){return[n.page,e%2==0?n.pageEven:n.pageOdd].join(" ")},c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},s=function(t){return e.request({method:"GET",url:t,initialValue:[],background:!0})},u={};u.controller=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.pageNum,r=e.prop([]);if(t.pageData){var n=t.pageData(i);n.then?n.then(function(e){r(e)}):r=n}else if(t.pageUrl){var o=t.pageUrl(i);s(o).then(function(t){return r(t),e.redraw()})}return{content:r,className:a(i),pageTag:t.pageTag||"div"}},u.view=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.pageId,n=i.pageSizes[r]||0,l=0;i.pageSize&&(l=i.pageSize(t.content()),i.updatePageSize(r,l));var a=l?l+"px":!i.autoSize||i.isScrolling&&n?n+"px":"auto",s=i.processPageData||function(e,t){return e?e.map(function(e,r){return i.item(e,t,r)}):null};return e(t.pageTag,{"data-page":r,class:t.className,style:n?c({},"x"===i.axis?{width:a}:{height:a}):{},config:l?null:function(t){var l=o(t,i.axis);l&&i.updatePageSize(r,l),n||setTimeout(e.redraw,0)}},s(t.content(),i))};var g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},d={};d.controller=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{className:a(e.pageNum)}},d.view=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.pageId,n=i.pageSizes[r]||0;return e("div",{"data-page":r,class:t.className,style:g({},"x"===i.axis?{width:n+"px"}:{height:n+"px"})})};var f,p=new i,h=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}},v=[r({},"."+n.scrollView,(f={"-webkit-overflow-scrolling":"touch",height:"100%"},r(f,"&."+n.scrollViewY,r({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+n.scrollContent,{height:"100%"})),r(f,"&."+n.scrollViewX,r({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+n.scrollContent,{width:"100%"})),f))];!function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];h(e);var n=document.createElement("style");e&&n.setAttribute("id",e),i.forEach(function(e){Object.keys(e).length&&e.forEach(function(e){var t={"@global":e},i=p.sheet(t);n.appendChild(document.createTextNode(i))})}),document.head.appendChild(n)}("mithril-infinite",v);var m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},S="000000",w=function(e){return S.substring(0,S.length-(""+e).length)+e},z=function(e,t){for(var i=t.sortedKeys,r=t.beforeSize||0,n=1,o=0;o<i.length;o+=1){var l=i[o];e>r&&(n=parseInt(l,10)),r+=t.pageSizes[l]}return n},x=function(e,t,i){var r=Math.max(0,e-1);if(t<r)return 0;var n=t,o=i.sortedKeys.slice(r,n),l=i.beforeSize||0;return l=o.reduce(function(e,t){return e+=i.pageSizes[t]||0},l),l+=i.afterSize||0},b=function(e,t,i,r){if(!r)return!1;var n=w(e),o=r.querySelector('[data-page="'+n+'"]');return l({el:o,axis:t})},y=function(e){return function(t,i){return e.state.pageSizes[t]=i,e.state.sortedKeys=Object.keys(e.state.pageSizes).sort()}},V={};return V.controller=function(e){var t="x"===e.axis?"scrollLeft":"scrollTop",i=void 0!==e.maxPages?e.maxPages:Number.MAX_VALUE,r=void 0===e.autoSize||!1!==e.autoSize,n=void 0!==e.throttle?1e3*e.throttle:200,o=e.contentTag||"div";return{state:{pageSizes:{},sortedKeys:[],beforeSize:null,afterSize:null},scrollView:null,isScrolling:!1,scrollWatchScrollingStateId:null,scrollWatchUpdateStateId:null,preloadSlots:e.preloadPages||1,boundingClientRect:{},currentPageNum:0,scrollAmount:0,whichScroll:t,maxPages:i,autoSize:r,scrollThrottle:n,contentTag:o}},V.view=function(t,i){var r=t.state;t.scrollAmount=t.scrollView?t.scrollView[t.whichScroll]:0;var l=i.currentPage?parseInt(i.currentPage,10):z(t.scrollAmount,r);l!==t.currentPageNum&&i.pageChange&&i.pageChange(l),t.currentPageNum=l,t.scrollView&&i.getDimensions&&i.getDimensions({scrolled:t.scrollAmount,size:t.contentSize});for(var a=i.from?parseInt(i.from,10):i.currentPage?i.currentPage:1,c=i.to?parseInt(i.to,10):i.currentPage?i.currentPage:t.maxPages,s=[],g=[],f=-t.preloadSlots;f<=t.preloadSlots;f+=1){var p=l+f;p>=a&&p<=c&&s.push(p)}for(var h=1;h<s[0];h+=1)g.push(h);var v=[n.scrollView,"x"===i.axis?n.scrollViewX:n.scrollViewY,i.class].join(" ");t.contentSize=x(1,c,r);var S=!c||b(c,i.axis,0,t.scrollView);if(t.scrollView){var V=t.scrollView.getBoundingClientRect();t.boundingClientRect=t.boundingClientRect||V,V.width===t.boundingClientRect.width&&V.height===t.boundingClientRect.height||(t.preloadSlots=i.preloadPages||1),t.boundingClientRect=V;var P=i.maxPreloadPages||Number.MAX_VALUE;t.contentSize&&t.preloadSlots<s.length&&t.preloadSlots<=P&&t.contentSize<V.height&&(t.preloadSlots++,setTimeout(e.redraw,0))}return e("div",{config:function(r,n,o){if(!n){if(i.scrollView?t.scrollView=document.querySelector(i.scrollView):t.scrollView=r,t.scrollView.className+=" "+v,i.setDimensions){var l=i.setDimensions(),a="x"===i.axis?"width":"height";l.size>0&&(r.style[a]=l.size+"px"),t.scrollView[t.whichScroll]=l.scrolled}var c=function(){t.isScrolling=!0,clearTimeout(t.scrollWatchScrollingStateId),t.scrollWatchScrollingStateId=setTimeout(function(){t.isScrolling=!1,e.redraw()},t.scrollThrottle),t.scrollWatchUpdateStateId||(t.scrollWatchUpdateStateId=setTimeout(function(){e.redraw(),t.scrollWatchUpdateStateId=null},t.scrollThrottle))};t.scrollView.addEventListener("scroll",c),o.onunload=function(){t.scrollView.removeEventListener("scroll",c)}}}},e("div",{class:n.scrollContent,style:t.autoSize?m({},"x"===i.axis?{width:t.contentSize+"px"}:{height:t.contentSize+"px"},i.contentSize?"x"===i.axis?{"min-width":i.contentSize+"px"}:{"min-height":i.contentSize+"px"}:{}):{}},[e(t.contentTag,{class:n.content},[i.before?e("div",{class:n.before,config:function(e){var t=o(e,i.axis);t&&(r.beforeSize=t)}},i.before):null,e("div",{class:n.pages},[g.map(function(t){return e(d,m({},i,{pageNum:t,pageId:w(t),pageSizes:r.pageSizes}))}),s.map(function(n){return e(u,m({},i,{pageNum:n,pageId:w(n),isScrolling:t.isScrolling,pageSizes:r.pageSizes,updatePageSize:y(t),autoSize:t.autoSize}))})]),i.after&&t.contentSize?e("div",{class:n.after,style:{visibility:S?"visible":"hidden"},config:function(e){var t=o(e,i.axis);t&&(r.afterSize=t)}},i.after):null])]))},V.isElementInViewport=l,V});
//# sourceMappingURL=mithril-infinite.js.map
