!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril"),require("verge"),require("j2c")):"function"==typeof define&&define.amd?define(["mithril","verge","j2c"],t):e["mithril-infinite"]=t(e.m,e.verge,e.j2c)}(this,function(e,t,i){"use strict";e="default"in e?e.default:e,t="default"in t?t.default:t,i="default"in i?i.default:i;var n={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",before:"mithril-infinite__before",after:"mithril-infinite__after"},r=300,o=function(e,t){var i=window.getComputedStyle(e);if("x"===t){var n=parseFloat(i.marginLeft)+parseFloat(i.marginRight);return e.scrollWidth+n}var r=parseFloat(i.marginTop)+parseFloat(i.marginBottom);return e.scrollHeight+r},l=function(e){var i=e.el,n=e.axis,o=void 0===n?"y":n,l=e.leeway,a=void 0===l?r:l;return"y"===o?t.inY(i,a)||t.inY(i,-a):"x"===o?t.inX(i,a)||t.inX(i,-a):t.inViewport(i,a)||t.inViewport(i,-a)},a=function(e){return[n.page,e%2===0?n.pageEven:n.pageOdd].join(" ")},c=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},u=function(t){return e.request({method:"GET",url:t,initialValue:[],background:!0})},g={};g.controller=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.pageNum,n=e.prop([]);if(t.pageData){var r=t.pageData(i);r.then?r.then(function(e){n(e)}):n=r}else if(t.pageUrl){var o=t.pageUrl(i);u(o).then(function(t){return n(t),e.redraw()})}return{content:n,className:a(i),pageTag:t.pageTag||"div"}},g.view=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.pageId,r=i.pageSizes[n]||0,l=0;i.pageSize&&(l=i.pageSize(t.content()),i.updatePageSize(n,l));var a=l?l+"px":!i.autoSize||i.isScrolling&&r?r+"px":"auto",c=i.processPageData||function(e,t){return e?e.map(function(e,n){return i.item(e,t,n)}):null};return e(t.pageTag,{"data-page":n,class:t.className,style:r?s({},"x"===i.axis?{width:a}:{height:a}):{},config:l?null:function(t){var l=o(t,i.axis);l&&i.updatePageSize(n,l),r||setTimeout(e.redraw,0)}},c(t.content(),i))};var d={};d.controller=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{className:a(e.pageNum)}},d.view=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.pageId,r=i.pageSizes[n]||0;return e("div",{"data-page":n,class:t.className,style:s({},"x"===i.axis?{width:r+"px"}:{height:r+"px"})})};var f,p=new i,h=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];v(e);var r=document.createElement("style");e&&r.setAttribute("id",e),i.forEach(function(e){Object.keys(e).length&&e.forEach(function(e){var t={"@global":e},i=p.sheet(t);r.appendChild(document.createTextNode(i))})}),document.head.appendChild(r)},v=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}},m=[c({},"."+n.scrollView,(f={"-webkit-overflow-scrolling":"touch",height:"100%"},c(f,"&."+n.scrollViewY,c({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+n.scrollContent,{height:"100%"})),c(f,"&."+n.scrollViewX,c({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+n.scrollContent,{width:"100%"})),f))];h("mithril-infinite",m);var S=200,w="000000",z=function(e){return w.substring(0,w.length-(""+e).length)+e},x=function(e,t){for(var i=t.sortedKeys,n=t.beforeSize||0,r=1,o=0;o<i.length;o+=1){var l=i[o];e>n&&(r=parseInt(l,10)),n+=t.pageSizes[l]}return r},b=function(e,t,i){var n=Math.max(0,e-1);if(t<n)return 0;var r=t,o=i.sortedKeys.slice(n,r),l=i.beforeSize||0;return l=o.reduce(function(e,t){return e+=i.pageSizes[t]||0},l),l+=i.afterSize||0},V=function(e,t,i,n){if(!n)return!1;var r=z(e),o=n.querySelector('[data-page="'+r+'"]');return l({el:o,axis:t})},y=function(e){return function(t,i){return e.state.pageSizes[t]=i,e.state.sortedKeys=Object.keys(e.state.pageSizes).sort()}},_={};return _.controller=function(e){var t="x"===e.axis?"scrollLeft":"scrollTop",i=void 0!==e.maxPages?e.maxPages:Number.MAX_VALUE,n=void 0===e.autoSize||e.autoSize!==!1,r=void 0!==e.throttle?1e3*e.throttle:S,o=e.contentTag||"div";return{state:{pageSizes:{},sortedKeys:[],beforeSize:null,afterSize:null},scrollView:null,isScrolling:!1,scrollWatchScrollingStateId:null,scrollWatchUpdateStateId:null,preloadSlots:e.preloadPages||1,boundingClientRect:{},currentPageNum:0,scrollAmount:0,whichScroll:t,maxPages:i,autoSize:n,scrollThrottle:r,contentTag:o}},_.view=function(t,i){var r=t.state;t.scrollAmount=t.scrollView?t.scrollView[t.whichScroll]:0;var l=i.currentPage?parseInt(i.currentPage,10):x(t.scrollAmount,r);l!==t.currentPageNum&&i.pageChange&&i.pageChange(l),t.currentPageNum=l,t.scrollView&&i.getDimensions&&i.getDimensions({scrolled:t.scrollAmount,size:t.contentSize});for(var a=i.from?parseInt(i.from,10):i.currentPage?i.currentPage:1,c=i.to?parseInt(i.to,10):i.currentPage?i.currentPage:t.maxPages,u=[],f=[],p=-t.preloadSlots;p<=t.preloadSlots;p+=1){var h=l+p;h>=a&&h<=c&&u.push(h)}for(var v=1;v<u[0];v+=1)f.push(v);var m=[n.scrollView,"x"===i.axis?n.scrollViewX:n.scrollViewY,i.class].join(" ");t.contentSize=b(1,c,r);var S=!c||V(c,i.axis,r,t.scrollView);if(t.scrollView){var w=t.scrollView.getBoundingClientRect();t.boundingClientRect=t.boundingClientRect||w,w.width===t.boundingClientRect.width&&w.height===t.boundingClientRect.height||(t.preloadSlots=i.preloadPages||1),t.boundingClientRect=w;var _=i.maxPreloadPages||Number.MAX_VALUE;t.contentSize&&t.preloadSlots<u.length&&t.preloadSlots<=_&&t.contentSize<w.height&&(t.preloadSlots++,setTimeout(e.redraw,0))}return e("div",{config:function(n,r,o){if(!r){if(i.scrollView?t.scrollView=document.querySelector(i.scrollView):t.scrollView=n,t.scrollView.className+=" "+m,i.setDimensions){var l=i.setDimensions(),a="x"===i.axis?"width":"height";l.size>0&&(n.style[a]=l.size+"px"),t.scrollView[t.whichScroll]=l.scrolled}var c=function(){t.isScrolling=!0,clearTimeout(t.scrollWatchScrollingStateId),t.scrollWatchScrollingStateId=setTimeout(function(){t.isScrolling=!1,e.redraw()},t.scrollThrottle),t.scrollWatchUpdateStateId||(t.scrollWatchUpdateStateId=setTimeout(function(){e.redraw(),t.scrollWatchUpdateStateId=null},t.scrollThrottle))};t.scrollView.addEventListener("scroll",c),o.onunload=function(){t.scrollView.removeEventListener("scroll",c)}}}},e("div",{class:n.scrollContent,style:t.autoSize?s({},"x"===i.axis?{width:t.contentSize+"px"}:{height:t.contentSize+"px"},i.contentSize?"x"===i.axis?{"min-width":i.contentSize+"px"}:{"min-height":i.contentSize+"px"}:{}):{}},[e(t.contentTag,{class:n.content},[i.before?e("div",{class:n.before,config:function(e){var t=o(e,i.axis);t&&(r.beforeSize=t)}},i.before):null,e("div",{class:n.pages},[f.map(function(t){return e(d,s({},i,{pageNum:t,pageId:z(t),pageSizes:r.pageSizes}))}),u.map(function(n){return e(g,s({},i,{pageNum:n,pageId:z(n),isScrolling:t.isScrolling,pageSizes:r.pageSizes,updatePageSize:y(t),autoSize:t.autoSize}))})]),i.after&&t.contentSize?e("div",{class:n.after,style:{visibility:S?"visible":"hidden"},config:function(e){var t=o(e,i.axis);t&&(r.afterSize=t)}},i.after):null])]))},_.isElementInViewport=l,_});
//# sourceMappingURL=mithril-infinite.js.map
