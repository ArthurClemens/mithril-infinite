!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mithril"),require("verge"),require("mithril/stream"),require("resize-observer-polyfill"),require("j2c")):"function"==typeof define&&define.amd?define(["mithril","verge","mithril/stream","resize-observer-polyfill","j2c"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mithrilInfinite=t(e.m,e.verge,e.stream,e["resize-observer-polyfill"],e.j2c)}(this,(function(e,t,r,n,i){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=a(e),l=a(t),s=a(r),u=a(n);function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw a}}}}var p,h={scrollView:"mithril-infinite__scroll-view",scrollViewX:"mithril-infinite__scroll-view--x",scrollViewY:"mithril-infinite__scroll-view--y",scrollContent:"mithril-infinite__scroll-content",content:"mithril-infinite__content",pages:"mithril-infinite__pages",page:"mithril-infinite__page",pageEven:"mithril-infinite__page--even",pageOdd:"mithril-infinite__page--odd",placeholder:"mithril-infinite__page--placeholder",before:"mithril-infinite__before",after:"mithril-infinite__after"},v=function(e,t){return"x"===t?e.offsetWidth:e.offsetHeight},m=function(e){var t=e.el,r=e.axis,n=void 0===r?"y":r,i=e.leeway,a=void 0===i?300:i;return"y"===n?l.default.inY(t,a)||l.default.inY(t,-a):"x"===n?l.default.inX(t,a)||l.default.inX(t,-a):l.default.inViewport(t,a)||l.default.inViewport(t,-a)},S=function(e){return[h.page,e%2==0?h.pageEven:h.pageOdd].join(" ")},w={oninit:function(e){var t=e.state,r=e.attrs,n=r.pageNum,i=s.default([]);if(r.pageData){var a=r.pageData(n);Promise.resolve(a).then(i).then(o.default.redraw)}else if(r.pageUrl){(function(e){return o.default.request({method:"GET",url:e})})(r.pageUrl(n)).then(i)}var l=r.processPageData||function(e,t){return e&&e.length?e.map((function(e,n){return r.item(e,t,n)})):null};t.content=i,t.className=S(n),t.pageTag=r.pageTag||"div",t.processPageData=l},view:function(e){var t=e.state,r=e.attrs,n=r.pageId,i=r.pageSizes[n]||0,a=0;r.pageSize&&(a=r.pageSize(t.content()),r.updatePageSize(n,a));var l=a?a+"px":r.autoSize?"auto":i+"px",s=function(e){if(!a){var t=v(e,r.axis);t&&r.updatePageSize(n,t)}};return o.default(t.pageTag,{"data-page":n,class:t.className,style:i?"x"===r.axis?{width:l}:{height:l}:null,oncreate:function(e){var t=e.dom;new u.default((function(e){var n,a=g(e);try{for(a.s();!(n=a.n()).done;){var o=n.value.contentRect,l=o.width,u=o.height;("x"===r.axis&&l!==i||"y"===r.axis&&u!==i)&&s(t)}}catch(e){a.e(e)}finally{a.f()}})).observe(t)},onupdate:function(e){var t=e.dom;return s(t)}},t.processPageData(t.content(),{pageId:r.pageId,pageNum:r.pageNum}))}},z={oninit:function(e){return e.state.className=S(e.attrs.pageNum)},view:function(e){var t=e.state,r=e.attrs,n=r.pageId,i=r.pageSizes[n]||0;return o.default("div",{"data-page":n,class:[h.placeholder,t.className].join(" "),style:f({},"x"===r.axis?{width:i+"px"}:{height:i+"px"})})}},y=new(a(i).default),b=function(e){if(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}};!function(e){b(e);var t=document.createElement("style");e&&t.setAttribute("id",e);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];n.forEach((function(e){Object.keys(e).length&&e.forEach((function(e){var r={"@global":e},n=y.sheet(r);t.appendChild(document.createTextNode(n))}))})),document.head.appendChild(t)}("mithril-infinite",[c({},"."+h.scrollView,(p={"-webkit-overflow-scrolling":"touch",height:"100%"},c(p," ."+h.scrollContent,{overflowAnchor:"none"}),c(p,"&."+h.scrollViewY,c({overflowX:"hidden",overflowY:"auto",height:"100%"}," ."+h.scrollContent,{height:"100%"})),c(p,"&."+h.scrollViewX,c({overflowX:"auto",overflowY:"hidden",width:"100%"}," ."+h.scrollContent,{width:"100%"})),p))]);var x="000000",P=function(e){return x.substring(0,x.length-(""+e).length)+e},V=function(e){return function(t,r){var n=e.pageSizes[t],i=parseInt(r,10);n!==i&&(e.pageSizes[t]=i,e.sortedKeys=Object.keys(e.pageSizes).sort(),C(e),setTimeout(o.default.redraw))}},_=function(e,t,r,n){var i=v(e,n);i&&(r[t]=i)},C=function(e){if(e.scrollView){var t=e.scrollView.getBoundingClientRect();e.boundingClientRect=e.boundingClientRect||t,t.width===e.boundingClientRect.width&&t.height===e.boundingClientRect.height||(e.preloadSlots=void 0!==e.attrsPreloadSlots?e.attrsPreloadSlots:1),e.boundingClientRect=t,e.contentSize&&e.preloadSlots<e.pageCount&&e.preloadSlots<=e.attrsMaxPreloadSlots&&e.contentSize<t.height&&(e.preloadSlots++,setTimeout(o.default.redraw))}};return{oninit:function(e){var t=e.attrs,r=t.axis||"y",n="x"===r?"scrollLeft":"scrollTop",i=void 0===t.autoSize||!1!==t.autoSize,a=t.pageSize,l=t.contentTag||"div",s=[h.scrollView,"x"===r?h.scrollViewX:h.scrollViewY,t.class].join(" "),u=o.default.redraw;f(e.state,{afterSize:0,beforeSize:0,boundingClientRect:{},currentPageNum:0,pageSizes:{},preloadSlots:void 0!==t.preloadPages?t.preloadPages:1,scrollView:null,sortedKeys:[],attrsMaxPreloadSlots:t.maxPreloadPages||Number.MAX_VALUE,attrsPreloadSlots:void 0!==t.preloadPages?t.preloadPages:1,autoSize:i,axis:r,classList:s,contentTag:l,pageSize:a,scroll:u,whichScroll:n})},view:function(e){var t=e.state,r=e.attrs,n=t.scrollView?t.scrollView[t.whichScroll]:0,i=t.axis,a=void 0!==r.maxPages?r.maxPages:Number.MAX_VALUE,l=r.currentPage?parseInt(r.currentPage,10):function(e,t){var r=t.sortedKeys;if(0===r.length)return 1;for(var n=t.before||0,i=1,a=0;a<r.length;a+=1){var o=r[a];e>n&&(i=parseInt(o,10)),n+=t.pageSizes[o]}return i}(n,t);r.pageChange&&l!==t.currentPageNum&&r.pageChange(l),t.currentPageNum=l,t.scrollView&&r.getDimensions&&r.getDimensions({scrolled:n,size:t.contentSize});var s=function(e,t,r,n,i,a){for(var o=t?parseInt(t,10):n||1,l=r?parseInt(r,10):n||a,s=[],u=[],c=-i;c<=i;c+=1){var f=e+c;f>=o&&f<=l&&s.push(f)}for(var d=1;d<s[0];d+=1)u.push(d);return{pages:s,prePages:u,maxPageNum:l}}(l,r.from,r.to,r.currentPage,t.preloadSlots,a),u=s.pages,c=s.prePages,d=s.maxPageNum;t.contentSize=void 0!==r.contentSize?r.contentSize:function(e,t,r){var n=Math.max(0,e-1);if(t<n)return 0;var i=t,a=0;return r.sortedKeys.slice(n,i).reduce((function(e,t){return e+(r.pageSizes[t]||0)}),a)}(1,d,t),C(t),t.pageCount=u.length;var g=!d||function(e,t,r){if(!r)return!1;var n=P(e),i=r.querySelector('[data-page="'.concat(n,'"]'));return m({el:i,axis:t})}(d,i,t.scrollView);return o.default("div",{oncreate:function(e){var n=e.dom;if(t.scrollView=r.scrollView?document.querySelector(r.scrollView):n,t.scrollView.className+=" "+t.classList,r.setDimensions){var a=r.setDimensions();if(a.size>0){var o="x"===i?"width":"height";n.style[o]=a.size+"px"}t.scrollView[t.whichScroll]=a.scrolled}t.scrollView.addEventListener("scroll",t.scroll)},onremove:function(){return t.scrollView.removeEventListener("scroll",t.scroll)}},o.default("div",{class:h.scrollContent,style:t.autoSize?f({},"x"===i?{width:t.contentSize+t.beforeSize+t.afterSize+"px"}:{height:t.contentSize+t.beforeSize+t.afterSize+"px"},r.contentSize?"x"===i?{"min-width":r.contentSize+t.beforeSize+t.afterSize+"px"}:{"min-height":r.contentSize+t.beforeSize+t.afterSize+"px"}:{}):null},[o.default(t.contentTag,{class:h.content},[r.before?o.default("div",{class:h.before,oncreate:function(e){var r=e.dom;return _(r,"beforeSize",t,i)},onupdate:function(e){var r=e.dom;return _(r,"beforeSize",t,i)}},r.before):null,o.default("div",{class:h.pages},[c.map((function(e){return o.default(z,{axis:i,key:(r.pageKey||P)(e),pageId:P(e),pageNum:e,pageSizes:t.pageSizes})})),u.map((function(e){return o.default(w,{autoSize:t.autoSize,axis:i,item:r.item,key:(r.pageKey||P)(e),pageData:r.pageData,pageId:P(e),pageNum:e,pageSize:t.pageSize,pageSizes:t.pageSizes,pageTag:r.pageTag,processPageData:r.processPageData,pageUrl:r.pageUrl,updatePageSize:V(t)})}))]),r.after&&t.contentSize?o.default("div",{class:h.after,style:{visibility:g?"visible":"hidden"},oncreate:function(e){var r=e.dom;return _(r,"afterSize",t,i)},onupdate:function(e){var r=e.dom;return _(r,"afterSize",t,i)}},r.after):null])]))},isElementInViewport:m}}));
//# sourceMappingURL=mithril-infinite.js.map
